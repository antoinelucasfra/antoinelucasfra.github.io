<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Antoine Lucas</title>
<link>https://antoinelucasfra.github.io/blog.html</link>
<atom:link href="https://antoinelucasfra.github.io/blog.xml" rel="self" type="application/rss+xml"/>
<description>Research Engineer — ML systems, deep learning, and LLM pipelines in scientific and regulated environments. Portfolio, blog, and projects.</description>
<image>
<url>https://antoinelucasfra.github.io/assets/images/profile-pic.jpg</url>
<title>Antoine Lucas</title>
<link>https://antoinelucasfra.github.io/blog.html</link>
</image>
<generator>quarto-1.8.27</generator>
<lastBuildDate>Mon, 23 Feb 2026 23:00:00 GMT</lastBuildDate>
<item>
  <title>Hello, R-Bloggers — What This Blog Is About</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/hello-r-bloggers/</link>
  <description><![CDATA[ 





<p>If you’re arriving here from R-Bloggers, welcome. This is a quick orientation.</p>
<p>I’m an applied statistician and ML engineer based in Paris. For the past five years I’ve been embedded in R&amp;D and clinical teams — at L’Oréal, Sanofi, a microbiome biotech, and currently Chanel Parfums Beauté — building data pipelines, statistical models, and ML systems in environments where reproducibility and auditability are not optional. R is my primary tool for statistical work, reporting, and Shiny applications; Python handles the ML side. Most posts here are field notes from that work: things I’ve worked out in production and thought worth documenting, for my future self as much as anyone else.</p>
<p>The R content on this blog is practitioner-focused. You’ll find posts on reproducibility in GxP-regulated environments, statistical methods applied to real formulation and clinical data, and R tooling that has earned its place in my daily workflow. Not beginner tutorials — notes from actual use.</p>
<p><strong>Three posts to start with:</strong></p>
<ul>
<li><a href="../../posts/reproducible-pharma-r/">Building Reproducible Analyses in Pharma with R</a> — how I structure R projects in regulated environments, from <code>renv</code> to audit-ready reporting</li>
<li><a href="../../posts/rv-modern-r-package-manager/">rv: The Modern R Package Manager for Reproducible Workflows</a> — a look at the Rust-backed package manager that is quietly replacing my <code>renv</code> workflow</li>
<li><a href="https://antoinelucasfra.github.io/posts/why-curate-resources/">Staying Current in a Fast-Moving Field: Why I Built a Resources Catalog</a> — on curation as a practice, and the catalog of 200+ data science resources I maintain</li>
</ul>
<p>The <a href="../../blog.html">full blog listing</a> has everything, filtered by category.</p>



<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>R</category>
  <category>Meta</category>
  <guid>https://antoinelucasfra.github.io/posts/hello-r-bloggers/</guid>
  <pubDate>Mon, 23 Feb 2026 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Voice to Data: An LLM Pipeline for Lab Notebooks</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/voice-to-data-lab-pipeline/</link>
  <description><![CDATA[ 





<section id="honest-preamble" class="level2">
<h2 class="anchored" data-anchor-id="honest-preamble">Honest preamble</h2>
<p>This is not a “your lab notebook will be automated in six months” post.</p>
<p>The friction I am describing is specific and concrete: a scientist at a bench during a formulation experiment has both hands occupied — one mixing, one holding a pipette — and a mental queue of observations that need to end up as structured records in an ELN or LIMS. The current workflow is to hold those observations in working memory and transcribe them later, or to stop the manipulation, wash hands, and type. Both routes introduce errors and cognitive load at exactly the moment when focus matters most.</p>
<p>Voice removes the keyboard as a barrier. An LLM turns unstructured speech into a structured, validated record. That is the scope of this article.</p>
<p><strong>A note on the code in this article:</strong> the pipeline described here is based on architecture developed for a client project in a regulated pharma R&amp;D context. The code snippets are deliberately simplified and generalized — they are illustrative of the design, not production implementations. They exist to communicate the structure of the solution, not to be copy-pasted into a clinical system. Domain-specific schemas, prompt libraries, and validation rules are internal to the projects they serve.</p>
<p>With that said, the architecture is real, the tooling choices are defensible, and the failure modes are drawn from actual use.</p>
<hr>
</section>
<section id="the-problem-in-concrete-terms" class="level2">
<h2 class="anchored" data-anchor-id="the-problem-in-concrete-terms">The problem in concrete terms</h2>
<p>Consider a formulation scientist working on a new topical emulsion. The experiment is a typical bench session: water phase preparation, thickener addition, pH adjustment, viscosity measurement, appearance assessment. Standard operating procedure (SOP) requires every observation to be recorded with timestamp, batch identifier, operator ID, measurement value with unit, and any deviation from expected range.</p>
<p>What actually happens:</p>
<ol type="1">
<li>The scientist records observations on a paper notepad during the experiment.</li>
<li>After the manipulation, they transcribe those notes into the ELN manually, often hours later.</li>
<li>The ELN entry requires navigating a form interface: selecting batch, selecting timepoint, entering individual fields one at a time.</li>
<li>This step takes 20–40 minutes for a typical bench session and happens at the end of the day when cognitive load is highest and recall is least reliable.</li>
</ol>
<p>The consequences are predictable:</p>
<ul>
<li><strong>Transcription errors</strong>: a pH of 6.8 becomes 6.9, a viscosity of 4,200 mPa·s is entered as 4,000 because the scientist no longer remembers the exact number.</li>
<li><strong>Missing fields</strong>: a deviation observed during the experiment is not recorded because it seemed minor at the time and was not written down.</li>
<li><strong>Lag</strong>: observations are not timestamped to the actual moment of measurement, breaking traceability.</li>
<li><strong>Inconsistent terminology</strong>: “slightly hazy”, “faintly turbid”, and “not fully clear” describe the same observation across three different entries by the same operator.</li>
</ul>
<p>None of these are failures of discipline. They are structural consequences of asking humans to buffer observations and serialize them later under time pressure.</p>
<p>The same pattern appears across cell culture passaging (confluence estimates, viability counts, media change notes), analytical assay readouts (HPLC peak flags, integration comments), and stability study pulls (visual appearance across timepoints). The domain varies; the friction is the same.</p>
<hr>
</section>
<section id="pipeline-architecture" class="level2">
<h2 class="anchored" data-anchor-id="pipeline-architecture">Pipeline architecture</h2>
<p>The pipeline has four stages. Each one has a defined input, output, and failure surface.</p>
<pre><code>┌─────────────────────────────────────────────────────┐
│  INPUT: Voice (real-time mic or recorded audio file) │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│  STAGE 1 — Automatic Speech Recognition (ASR)       │
│  Tool: faster-whisper                               │
│  Output: raw transcript text                        │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│  STAGE 2 — Structured Extraction                    │
│  Tool: Instructor + Pydantic + Ollama (local LLM)   │
│  Output: typed, schema-conformant record            │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│  STAGE 3 — Validation                               │
│  Tool: Pydantic validators + DomainValidator class  │
│  Output: validated record or flagged review item    │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│  STAGE 4 — Serialization + Handoff                  │
│  Output: JSON / CSV / REST payload + audit record   │
└─────────────────────────────────────────────────────┘</code></pre>
<p>A note on the audio input mode. There are two architecturally distinct configurations:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Mode</th>
<th>Description</th>
<th>Trade-offs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Batch / deferred</strong></td>
<td>Scientist records a voice memo (phone, bench recorder); file is uploaded and processed after the experiment</td>
<td>Simpler to implement; introduces slight lag; no real-time feedback</td>
</tr>
<tr class="even">
<td><strong>Real-time streaming</strong></td>
<td>Microphone streams audio continuously; ASR runs on chunks; extraction runs per utterance</td>
<td>Lower latency; higher complexity; requires streaming ASR API</td>
</tr>
</tbody>
</table>
<p>For a formulation bench context specifically, <strong>batch mode is the correct primary choice</strong>. A scientist with wet hands and a live emulsion in the mixer does not interact with a UI mid-experiment. The workflow is: speak a memo at each observation point, submit the audio at the end of the session. Streaming is useful for longer monitoring sessions where observations are sparse and well-separated in time. The code in this article implements the batch path.</p>
<hr>
</section>
<section id="stage-1-automatic-speech-recognition" class="level2">
<h2 class="anchored" data-anchor-id="stage-1-automatic-speech-recognition">Stage 1 — Automatic Speech Recognition</h2>
<section id="why-whisper-and-why-locally" class="level3">
<h3 class="anchored" data-anchor-id="why-whisper-and-why-locally">Why Whisper, and why locally</h3>
<p><a href="https://github.com/openai/whisper">Whisper</a> is OpenAI’s open-weights ASR model. The key word is open-weights: you run it on your own hardware, no audio leaves your network. In a pharma R&amp;D context, this is not optional — it is the only defensible configuration. Audio recordings of experiments may contain compound names under NDA, formulation parameters that are trade secrets, or batch identifiers tied to regulatory submissions. Sending this audio to a cloud ASR API requires a data processing agreement, legal sign-off, and in many organizations will simply not be permitted.</p>
<p><a href="https://github.com/SYSTRAN/faster-whisper"><code>faster-whisper</code></a> is a re-implementation of Whisper using CTranslate2 that runs 2–4× faster than the original PyTorch implementation on CPU, and significantly faster on GPU. On a standard lab workstation without a GPU, <code>faster-whisper</code> with the <code>medium</code> model transcribes a 3-minute audio file in approximately 15–20 seconds. Acceptable for batch mode.</p>
</section>
<section id="the-pharma-vocabulary-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-pharma-vocabulary-problem">The pharma vocabulary problem</h3>
<p>Whisper is trained on general speech. It will misrecognize:</p>
<ul>
<li>Compound names: “carbomer 980” may transcribe as “carbon 980”, “hydrocarbomer” as “hydro carbomer”</li>
<li>Concentration notation: “0.5% w/w” may come out as “0.5 percent double u double u”</li>
<li>Unit abbreviations: “mPa·s” will not survive as-is; the scientist typically says “millipascal seconds” or “cP”</li>
<li>Abbreviations: “API”, “pH”, “RPM”, “BID”, “QC”</li>
</ul>
<p>Mitigation strategies:</p>
<ol type="1">
<li><strong>Initial prompt priming</strong>: <code>faster-whisper</code> accepts an <code>initial_prompt</code> parameter. This is injected at the start of the transcription and nudges the model toward your vocabulary. A prompt like <code>"Formulation lab note. Batch F-204. pH, viscosity mPa·s, carbomer, excipient, API concentration."</code> meaningfully improves recognition of domain terms.</li>
<li><strong>Post-processing normalization</strong>: a lightweight text normalization step after ASR can standardize units and abbreviations before the extraction stage.</li>
<li><strong>Fine-tuning</strong>: for high-volume deployments, Whisper can be fine-tuned on domain-specific audio. Out of scope for this article.</li>
</ol>
</section>
<section id="noise-in-the-lab" class="level3">
<h3 class="anchored" data-anchor-id="noise-in-the-lab">Noise in the lab</h3>
<p>A formulation lab is not a recording studio. Overhead extractors, magnetic stirrers, water baths, and centrifuges all produce background noise. Practical guidance:</p>
<ul>
<li>Use a directional (cardioid) lapel or desktop microphone, not the built-in microphone on a laptop or phone</li>
<li>Whisper’s <code>medium</code> and <code>large</code> models handle moderate noise better than <code>tiny</code> or <code>base</code></li>
<li>Consider a noise-suppression preprocessing step (e.g.&nbsp;<a href="https://github.com/timsainburg/noisereduce"><code>noisereduce</code></a>) for particularly noisy environments</li>
</ul>
<hr>
</section>
</section>
<section id="stage-2-structured-extraction" class="level2">
<h2 class="anchored" data-anchor-id="stage-2-structured-extraction">Stage 2 — Structured extraction</h2>
<section id="the-core-challenge-unstructured-hedged-incomplete-speech" class="level3">
<h3 class="anchored" data-anchor-id="the-core-challenge-unstructured-hedged-incomplete-speech">The core challenge: unstructured, hedged, incomplete speech</h3>
<p>This is the hardest stage. A scientist dictating during an experiment does not produce clean, form-like speech. Here is a realistic transcript from a formulation session:</p>
<blockquote class="blockquote">
<p><em>“Okay so this is Antoine, batch F-204, it’s about 14:32. I’ve just added 1.2 grams of carbomer to the water phase, mixing at 500 RPM. Viscosity is approximately 4,200 — that’s in millipascal seconds — pH is 5.9. Appearance is slightly hazy, no lumps visible. No deviations to report.”</em></p>
</blockquote>
<p>Problems the extraction layer must handle:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Speech pattern</th>
<th>Example</th>
<th>What to do</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Hedged values</td>
<td>“approximately 4,200”, “maybe 6.8”</td>
<td>Extract the value; set a <code>hedged</code> flag</td>
</tr>
<tr class="even">
<td>Inferred units</td>
<td>“that’s in millipascal seconds”</td>
<td>Associate retrospectively with the preceding value</td>
</tr>
<tr class="odd">
<td>Missing fields</td>
<td>Batch ID not stated</td>
<td>Set to <code>null</code>; trigger review flag</td>
</tr>
<tr class="even">
<td>Conversational filler</td>
<td>“Okay so”, “that’s about”</td>
<td>Ignore in extraction</td>
</tr>
<tr class="odd">
<td>Multiple measurements in one utterance</td>
<td>pH and viscosity in same sentence</td>
<td>Extract as separate records or a multi-measurement record</td>
</tr>
</tbody>
</table>
</section>
<section id="why-instructor" class="level3">
<h3 class="anchored" data-anchor-id="why-instructor">Why Instructor</h3>
<p><a href="https://python.useinstructor.com/">Instructor</a> is a library that wraps LLM API calls to guarantee structured output conforming to a Pydantic schema. Instead of asking the LLM to “return JSON”, which produces unreliable free-form output, Instructor uses tool-calling or structured output modes to force the model to populate every field of your schema. If the model cannot populate a field, it sets it to <code>null</code> rather than hallucinating a value.</p>
<p>This is the critical reliability mechanism of the pipeline. Without it, you are parsing free-form LLM JSON output with all the brittleness that entails.</p>
</section>
<section id="the-pydantic-schema" class="level3">
<h3 class="anchored" data-anchor-id="the-pydantic-schema">The Pydantic schema</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseModel, Field</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> enum <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Enum</span>
<span id="cb2-5"></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> AppearanceDescriptor(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Enum):</span>
<span id="cb2-8">    CLEAR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clear"</span></span>
<span id="cb2-9">    SLIGHTLY_HAZY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slightly_hazy"</span></span>
<span id="cb2-10">    HAZY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hazy"</span></span>
<span id="cb2-11">    TURBID <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"turbid"</span></span>
<span id="cb2-12">    OPAQUE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opaque"</span></span>
<span id="cb2-13">    OTHER <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb2-14"></span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> LabObservation(BaseModel):</span>
<span id="cb2-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Structured record of a single lab observation extracted from voice."""</span></span>
<span id="cb2-18"></span>
<span id="cb2-19">    sample_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-21">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample identifier as stated by the operator (e.g. 'F-204')"</span>,</span>
<span id="cb2-22">    )</span>
<span id="cb2-23">    batch_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-25">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Batch identifier if distinct from sample_id"</span>,</span>
<span id="cb2-26">    )</span>
<span id="cb2-27">    operator_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-28">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-29">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Operator name or ID as stated in the recording"</span>,</span>
<span id="cb2-30">    )</span>
<span id="cb2-31">    stated_timestamp: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-33">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time stated by the operator (e.g. '14:32'), as a string"</span>,</span>
<span id="cb2-34">    )</span>
<span id="cb2-35">    measurement_type: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-37">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type of measurement (e.g. 'viscosity', 'pH', 'temperature')"</span>,</span>
<span id="cb2-38">    )</span>
<span id="cb2-39">    value: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-41">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Numeric value of the measurement"</span>,</span>
<span id="cb2-42">    )</span>
<span id="cb2-43">    unit: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-44">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-45">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unit of the measurement (e.g. 'mPa·s', 'pH', '°C', 'g')"</span>,</span>
<span id="cb2-46">    )</span>
<span id="cb2-47">    appearance: Optional[AppearanceDescriptor] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-48">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-49">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Appearance descriptor if stated"</span>,</span>
<span id="cb2-50">    )</span>
<span id="cb2-51">    ingredient_added: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-52">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-53">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Name of any ingredient or excipient added during this observation"</span>,</span>
<span id="cb2-54">    )</span>
<span id="cb2-55">    ingredient_quantity: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb2-56">    ingredient_unit: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb2-57">    deviation_flag: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-58">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb2-59">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True if the operator reported a deviation from expected range"</span>,</span>
<span id="cb2-60">    )</span>
<span id="cb2-61">    hedged: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-62">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb2-63">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True if the value was qualified ('approximately', 'about', 'maybe')"</span>,</span>
<span id="cb2-64">    )</span>
<span id="cb2-65">    notes: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(</span>
<span id="cb2-66">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb2-67">        description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Any additional free-text observations not captured in structured fields"</span>,</span>
<span id="cb2-68">    )</span></code></pre></div></div>
<p>The schema uses <code>Optional</code> for every observation field except <code>deviation_flag</code> and <code>hedged</code>. This is deliberate: a missing field is more honest than a hallucinated one. The downstream validation stage decides what to do with <code>null</code> values.</p>
<p>The <code>AppearanceDescriptor</code> enum is a controlled vocabulary. Free-text appearance descriptions (“slightly hazy”, “not fully clear”, “faintly turbid”) are mapped to a fixed set of terms by the LLM. This solves the inconsistent terminology problem at source.</p>
</section>
<section id="prompt-engineering" class="level3">
<h3 class="anchored" data-anchor-id="prompt-engineering">Prompt engineering</h3>
<p>Few-shot examples are the most important part of the prompt. The examples must include clean inputs <em>and</em> realistic messy inputs — hedged values, missing fields, multi-measurement utterances.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">SYSTEM_PROMPT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">You are a laboratory data extraction assistant for a pharmaceutical formulation lab.</span></span>
<span id="cb3-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Your task is to extract structured observations from a voice transcript of a scientist</span></span>
<span id="cb3-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">recording bench notes.</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Rules:</span></span>
<span id="cb3-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- Extract only what is explicitly stated. Do not infer or assume field values.</span></span>
<span id="cb3-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- If a value is hedged ("approximately", "about", "maybe", "around"), set hedged=true.</span></span>
<span id="cb3-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- If a field is not stated, set it to null. Never invent a value.</span></span>
<span id="cb3-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- Map appearance descriptions to the closest AppearanceDescriptor enum value.</span></span>
<span id="cb3-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- If multiple measurements are stated in one transcript, extract only the primary one</span></span>
<span id="cb3-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  and put the rest in the notes field.</span></span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Examples:</span></span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Input: "Antoine here, batch F-204, pH is 5.9, no issues."</span></span>
<span id="cb3-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Output: {operator_id: "Antoine", batch_id: "F-204", measurement_type: "pH",</span></span>
<span id="cb3-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">         value: 5.9, unit: "pH", deviation_flag: false, hedged: false}</span></span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Input: "Viscosity is about 4,200 millipascal seconds, appearance is slightly hazy."</span></span>
<span id="cb3-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Output: {measurement_type: "viscosity", value: 4200.0, unit: "mPa·s",</span></span>
<span id="cb3-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">         appearance: "slightly_hazy", hedged: true}</span></span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Input: "Added 1.2 grams of carbomer, mixing at 500 RPM."</span></span>
<span id="cb3-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Output: {ingredient_added: "carbomer", ingredient_quantity: 1.2,</span></span>
<span id="cb3-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">         ingredient_unit: "g", notes: "mixing at 500 RPM"}</span></span>
<span id="cb3-27"></span>
<span id="cb3-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Input: "Batch F-205, everything looks fine."</span></span>
<span id="cb3-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Output: {batch_id: "F-205", notes: "operator stated 'everything looks fine'",</span></span>
<span id="cb3-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">         deviation_flag: false}</span></span>
<span id="cb3-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span></code></pre></div></div>
<p>Note the last example: “everything looks fine” is not a structured observation. The correct extraction is to put it in <code>notes</code> and extract no measurement values, rather than inventing a plausible value because one is expected.</p>
</section>
<section id="running-extraction-with-instructor-and-ollama" class="level3">
<h3 class="anchored" data-anchor-id="running-extraction-with-instructor-and-ollama">Running extraction with Instructor and Ollama</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> instructor</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ollama <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Client</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ValidationError</span>
<span id="cb4-4"></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> extract_observation(transcript: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> LabObservation:</span>
<span id="cb4-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract a structured LabObservation from a raw ASR transcript.</span></span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">NOTE</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: This is an illustrative implementation. In production, the Ollama</span></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    client configuration, model selection, and prompt engineering are</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    environment-specific and not shown here.</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb4-14">    ollama_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Client(host<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span>)</span>
<span id="cb4-15"></span>
<span id="cb4-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Patch the Ollama client with Instructor to enforce structured output</span></span>
<span id="cb4-17">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> instructor.from_ollama(</span>
<span id="cb4-18">        ollama_client,</span>
<span id="cb4-19">        mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>instructor.Mode.JSON,</span>
<span id="cb4-20">    )</span>
<span id="cb4-21"></span>
<span id="cb4-22">    observation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb4-23">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llama3.1:8b"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or any locally available model</span></span>
<span id="cb4-24">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb4-25">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: SYSTEM_PROMPT},</span>
<span id="cb4-26">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Extract the observation from this transcript:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>transcript<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>},</span>
<span id="cb4-27">        ],</span>
<span id="cb4-28">        response_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LabObservation,</span>
<span id="cb4-29">    )</span>
<span id="cb4-30"></span>
<span id="cb4-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> observation</span></code></pre></div></div>
<p>The model choice matters. For this task, an 8B instruction-tuned model (Llama 3.1 8B, Mistral 7B) is sufficient — the extraction task is not reasoning-heavy, it is slot-filling against a fixed schema. Larger models add latency without proportional quality gains for this specific use case. In a regulated environment with sensitive formulation data, the model must run locally. Cloud model APIs are not an option without a data processing agreement.</p>
<hr>
</section>
</section>
<section id="stage-3-validation" class="level2">
<h2 class="anchored" data-anchor-id="stage-3-validation">Stage 3 — Validation</h2>
<p>Validation operates at two distinct levels that must be kept separate.</p>
<section id="structural-validation-pydantic" class="level3">
<h3 class="anchored" data-anchor-id="structural-validation-pydantic">Structural validation (Pydantic)</h3>
<p>Pydantic enforces the schema: types are correct, enums are valid, numeric fields are numeric. This happens automatically during extraction — Instructor will retry the LLM call if the output does not conform. Structural validation failures are hard blocks: the record cannot proceed until the schema is satisfied.</p>
</section>
<section id="domain-validation-domainvalidator" class="level3">
<h3 class="anchored" data-anchor-id="domain-validation-domainvalidator">Domain validation (DomainValidator)</h3>
<p>Domain validation checks scientific plausibility. Pydantic cannot know that a pH of 14.5 is physically impossible, or that a viscosity of 50,000 mPa·s is outside the expected range for a given formulation type. These are soft failures: the record is flagged for human review, not discarded.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass, field</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> NamedTuple</span>
<span id="cb5-3"></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> ValidationResult(NamedTuple):</span>
<span id="cb5-6">    passed: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb5-7">    flags: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb5-8">    requires_review: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb5-9"></span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb5-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DomainValidator:</span>
<span id="cb5-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Applies domain-specific plausibility checks to a LabObservation.</span></span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">NOTE</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: Thresholds, unit whitelists, and mandatory field rules are</span></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    project-specific. The values shown here are illustrative only.</span></span>
<span id="cb5-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb5-19"></span>
<span id="cb5-20">    ph_range: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.0</span>)</span>
<span id="cb5-21">    viscosity_range_mpas: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">200_000.0</span>)</span>
<span id="cb5-22">    allowed_units: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> field(default_factory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span>: {</span>
<span id="cb5-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pH"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pH"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>],</span>
<span id="cb5-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viscosity"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mPa·s"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mPas"</span>],</span>
<span id="cb5-25">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temperature"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"°C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"°F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"K"</span>],</span>
<span id="cb5-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mass"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mg"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kg"</span>],</span>
<span id="cb5-27">    })</span>
<span id="cb5-28">    mandatory_fields: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> field(default_factory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span>: [</span>
<span id="cb5-29">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"batch_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"operator_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"measurement_type"</span></span>
<span id="cb5-30">    ])</span>
<span id="cb5-31"></span>
<span id="cb5-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> validate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, obs: LabObservation) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ValidationResult:</span>
<span id="cb5-33">        flags <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-34"></span>
<span id="cb5-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mandatory field check</span></span>
<span id="cb5-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.mandatory_fields:</span>
<span id="cb5-37">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(obs, f) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb5-38">                flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"MISSING_MANDATORY_FIELD:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-39"></span>
<span id="cb5-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pH plausibility</span></span>
<span id="cb5-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.measurement_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pH"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> obs.value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb5-42">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ph_range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> obs.value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ph_range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]):</span>
<span id="cb5-43">                flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IMPLAUSIBLE_PH:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-44"></span>
<span id="cb5-45">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Viscosity plausibility</span></span>
<span id="cb5-46">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.measurement_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viscosity"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> obs.value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb5-47">            lo, hi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.viscosity_range_mpas</span>
<span id="cb5-48">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> (lo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> obs.value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> hi):</span>
<span id="cb5-49">                flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IMPLAUSIBLE_VISCOSITY:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-50"></span>
<span id="cb5-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unit whitelist</span></span>
<span id="cb5-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.measurement_type <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> obs.unit:</span>
<span id="cb5-53">            allowed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.allowed_units.get(obs.measurement_type, [])</span>
<span id="cb5-54">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> allowed <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> obs.unit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> allowed:</span>
<span id="cb5-55">                flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"UNEXPECTED_UNIT:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_for_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>measurement_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-56"></span>
<span id="cb5-57">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Hedged values always go to review</span></span>
<span id="cb5-58">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.hedged:</span>
<span id="cb5-59">            flags.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEDGED_VALUE:confirm_with_operator"</span>)</span>
<span id="cb5-60"></span>
<span id="cb5-61">        passed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(</span>
<span id="cb5-62">            f.startswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IMPLAUSIBLE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MISSING_MANDATORY"</span>))</span>
<span id="cb5-63">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> flags</span>
<span id="cb5-64">        )</span>
<span id="cb5-65">        requires_review <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(flags) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-66"></span>
<span id="cb5-67">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> ValidationResult(passed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>passed, flags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flags, requires_review<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>requires_review)</span></code></pre></div></div>
<p>The two-tier failure behaviour: - <code>passed=False</code>: hard block. The record is not serialized to the primary output. It goes to a rejection log. - <code>requires_review=True, passed=True</code>: soft flag. The record is serialized but routed to a review queue before being committed to the ELN/LIMS.</p>
</section>
<section id="the-human-review-queue" class="level3">
<h3 class="anchored" data-anchor-id="the-human-review-queue">The human-review queue</h3>
<p>Every record that exits Stage 3 with <code>requires_review=True</code> must be handled by a human before it is committed. The minimum viable review mechanism:</p>
<ol type="1">
<li><strong>Trigger</strong>: any of <code>MISSING_MANDATORY_FIELD</code>, <code>HEDGED_VALUE</code>, <code>UNEXPECTED_UNIT</code>, or <code>IMPLAUSIBLE_*</code> flags</li>
<li><strong>Reviewer sees</strong>: the original audio file path, the raw ASR transcript, the extracted record, and the specific flags</li>
<li><strong>Reviewer action</strong>: approve (record commits as-is), edit (modify specific fields and approve), or reject (record is discarded with a reason code)</li>
<li><strong>Audit capture</strong>: the reviewer action, reviewer ID, and timestamp are appended to the audit trail record — not to the observation record itself</li>
</ol>
<p>This is not a UI spec. It is the minimum information architecture for compliance. In a GxP system, the review step is the electronic signature event under 21 CFR Part 11. It cannot be implicit.</p>
<hr>
</section>
</section>
<section id="stage-4-serialization-and-handoff" class="level2">
<h2 class="anchored" data-anchor-id="stage-4-serialization-and-handoff">Stage 4 — Serialization and handoff</h2>
<section id="the-audit-record" class="level3">
<h3 class="anchored" data-anchor-id="the-audit-record">The audit record</h3>
<p>Every observation that exits the pipeline — whether it committed cleanly or went through review — must have an audit record attached. The audit record is separate from the observation record and is never edited after creation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timezone</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass</span>
<span id="cb6-5"></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb6-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> AuditRecord:</span>
<span id="cb6-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Immutable audit trail record for a single pipeline run.</span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Stored alongside (but separately from) the observation record.</span></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb6-13">    pipeline_run_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb6-14">    audio_file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb6-15">    asr_model_version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># e.g. "faster-whisper:medium:ct2"</span></span>
<span id="cb6-16">    llm_model_version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># e.g. "ollama:llama3.1:8b"</span></span>
<span id="cb6-17">    instructor_version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># e.g. "1.3.4"</span></span>
<span id="cb6-18">    raw_transcript: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># verbatim ASR output — never modified</span></span>
<span id="cb6-19">    extraction_timestamp: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ISO 8601, UTC</span></span>
<span id="cb6-20">    validation_flags: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb6-21">    review_required: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb6-22">    reviewer_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># None if auto-committed</span></span>
<span id="cb6-23">    reviewer_timestamp: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb6-24">    commit_status: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "committed", "rejected", "pending_review"</span></span>
<span id="cb6-25"></span>
<span id="cb6-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> to_dict(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb6-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-28">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pipeline_run_id"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.pipeline_run_id,</span>
<span id="cb6-29">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"audio_file_path"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.audio_file_path,</span>
<span id="cb6-30">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asr_model_version"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.asr_model_version,</span>
<span id="cb6-31">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm_model_version"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm_model_version,</span>
<span id="cb6-32">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"instructor_version"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.instructor_version,</span>
<span id="cb6-33">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_transcript_sha256"</span>: hashlib.sha256(</span>
<span id="cb6-34">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.raw_transcript.encode()</span>
<span id="cb6-35">            ).hexdigest(),</span>
<span id="cb6-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extraction_timestamp"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.extraction_timestamp,</span>
<span id="cb6-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"validation_flags"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.validation_flags,</span>
<span id="cb6-38">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"review_required"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.review_required,</span>
<span id="cb6-39">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reviewer_id"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.reviewer_id,</span>
<span id="cb6-40">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reviewer_timestamp"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.reviewer_timestamp,</span>
<span id="cb6-41">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commit_status"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.commit_status,</span>
<span id="cb6-42">        }</span></code></pre></div></div>
<p>Note: the raw transcript is stored as a SHA-256 hash in the audit record (the full text lives in a separate immutable store). This satisfies the traceability requirement without duplicating potentially sensitive text across every record.</p>
</section>
<section id="json-output-structure" class="level3">
<h3 class="anchored" data-anchor-id="json-output-structure">JSON output structure</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"observation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"sample_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"batch_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F-204"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"operator_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Antoine"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"stated_timestamp"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"14:32"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"measurement_type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viscosity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"value"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4200.0</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"unit"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mPa·s"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"appearance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slightly_hazy"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ingredient_added"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"carbomer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ingredient_quantity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ingredient_unit"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-14">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"deviation_flag"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hedged"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-16">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"notes"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mixing at 500 RPM"</span></span>
<span id="cb7-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb7-18">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"audit"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-19">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"pipeline_run_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"run_20260222_143512_a3f9"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-20">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"asr_model_version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"faster-whisper:medium:ct2"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-21">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"llm_model_version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama:llama3.1:8b"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-22">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"raw_transcript_sha256"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e3b0c44298fc1c..."</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-23">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extraction_timestamp"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-22T14:35:12Z"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-24">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"validation_flags"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEDGED_VALUE:confirm_with_operator"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-25">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"review_required"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-26">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"commit_status"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pending_review"</span></span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
</section>
<section id="lims-eln-handoff" class="level3">
<h3 class="anchored" data-anchor-id="lims-eln-handoff">LIMS / ELN handoff</h3>
<p>The pipeline produces a validated JSON record. How it reaches the downstream system depends on the system:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Integration pattern</th>
<th>When to use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CSV drop to watched folder</td>
<td>ELN systems with a CSV import feature; simplest path</td>
</tr>
<tr class="even">
<td>REST API POST</td>
<td>LIMS systems with an HTTP API (Benchling, LabVantage, etc.)</td>
</tr>
<tr class="odd">
<td>Direct DB insert</td>
<td>In-house systems where you control the schema</td>
</tr>
<tr class="even">
<td>Message queue (e.g.&nbsp;RabbitMQ)</td>
<td>High-volume or multi-lab deployments</td>
</tr>
</tbody>
</table>
<p>The pipeline itself should be agnostic to the downstream system. The serialized JSON is the contract. Adapters that translate the JSON to each downstream format are separate, thin components — this is the standard ETL pattern applied to lab data.</p>
<hr>
</section>
</section>
<section id="failure-modes" class="level2">
<h2 class="anchored" data-anchor-id="failure-modes">Failure modes</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Failure mode</th>
<th>Stage</th>
<th>Symptom</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Compound name misrecognition</td>
<td>ASR</td>
<td>“carbomer” → “carbon”</td>
<td><code>initial_prompt</code> with domain vocabulary</td>
</tr>
<tr class="even">
<td>Unit misrecognition</td>
<td>ASR</td>
<td>“mPa·s” → unintelligible</td>
<td>Post-processing normalization; train operators to say full unit names</td>
</tr>
<tr class="odd">
<td>Hallucinated measurement value</td>
<td>Extraction</td>
<td>LLM invents a value not in the transcript</td>
<td>Instructor forces schema; <code>null</code> is always preferred over a guess; review hedged values</td>
</tr>
<tr class="even">
<td>Missing mandatory field</td>
<td>Extraction</td>
<td><code>batch_id: null</code></td>
<td>Validation flags <code>MISSING_MANDATORY_FIELD</code>; routes to review</td>
</tr>
<tr class="odd">
<td>Implausible value passes extraction</td>
<td>Validation</td>
<td>pH extracted as 15.2</td>
<td>DomainValidator plausibility checks; hard block on <code>IMPLAUSIBLE_*</code></td>
</tr>
<tr class="even">
<td>Fume hood / stirrer noise</td>
<td>ASR</td>
<td>High word error rate</td>
<td>Directional microphone; <code>noisereduce</code> preprocessing; <code>large</code> model</td>
</tr>
<tr class="odd">
<td>Operator forgets sample ID</td>
<td>Prompt design</td>
<td><code>sample_id: null</code> in every record</td>
<td>Structured dictation prompt (“state batch ID first”) in operator training; mandatory field review</td>
</tr>
<tr class="even">
<td>LLM model update changes extraction behaviour</td>
<td>Compliance</td>
<td>Record comparison across model versions breaks</td>
<td>Version-lock models; treat model updates as revalidation events (see compliance section)</td>
</tr>
<tr class="odd">
<td>Operator says “it looks fine”</td>
<td>Extraction</td>
<td>Vague assertion extracted as measurement</td>
<td><code>notes</code> field captures it; no measurement value extracted; no validation failure</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="data-governance-and-compliance" class="level2">
<h2 class="anchored" data-anchor-id="data-governance-and-compliance">Data governance and compliance</h2>
<div class="callout-regulatory">
<p>This section covers general principles relevant to pharma and biotech R&amp;D. It is not legal or regulatory advice. Your organization’s quality assurance and legal teams must review any system that touches regulated data before deployment.</p>
</div>
<section id="cfr-part-11-and-ema-annex-11" class="level3">
<h3 class="anchored" data-anchor-id="cfr-part-11-and-ema-annex-11">21 CFR Part 11 and EMA Annex 11</h3>
<p>Electronic records in GxP environments must be trustworthy, reliable, and equivalent to paper records. The relevant requirements for this pipeline:</p>
<ul>
<li><strong>Audit trail</strong>: every record must have a time-stamped, operator-attributed, uneditable audit trail. The <code>AuditRecord</code> structure above covers this. The raw transcript (or its hash) must be retained alongside the structured record — you must be able to demonstrate that the extracted values correspond to what the operator said.</li>
<li><strong>Electronic signature</strong>: the review-and-approve step is an electronic signature event. The reviewer ID and timestamp must be captured and linked to the record. This requires identity verification — a username/password at minimum, hardware token in higher-assurance contexts.</li>
<li><strong>System validation</strong>: the pipeline itself must be validated under your organization’s computer system validation (CSV) framework. This means documented user requirements, functional specifications, and qualification testing. The LLM component is a challenge here — see below.</li>
</ul>
</section>
<section id="the-llm-model-versioning-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-llm-model-versioning-problem">The LLM model versioning problem</h3>
<p>This is the hardest compliance issue in this architecture. Classical validated software produces deterministic outputs: the same input always produces the same output, forever. An LLM does not. Two consequences:</p>
<ol type="1">
<li><strong>Extraction behaviour changes between model versions.</strong> If you update from <code>llama3.1:8b</code> to <code>llama3.2:8b</code>, the structured output for the same transcript may differ. This breaks the assumption that records are comparable across time.</li>
<li><strong>The same model with different temperature settings can produce different outputs for identical inputs.</strong></li>
</ol>
<p>Practical mitigations: - <strong>Version-lock the ASR and LLM models.</strong> Pin <code>faster-whisper</code> to a specific checkpoint hash; pin the Ollama model to a specific version tag. Never update without going through a revalidation cycle. - <strong>Set temperature to 0</strong> for extraction calls. This makes the LLM as deterministic as possible (not fully deterministic, but close enough for most practical purposes). - <strong>Treat model updates as change control events</strong>: document the change, run qualification tests against a golden dataset of transcripts with known expected outputs, and obtain QA sign-off before deploying the new version. - <strong>The raw transcript is the source of truth.</strong> If the extracted record is ever challenged, the raw audio and transcript are the evidence. Store both.</p>
</section>
<section id="gdpr-and-data-retention" class="level3">
<h3 class="anchored" data-anchor-id="gdpr-and-data-retention">GDPR and data retention</h3>
<p>Audio recordings may contain personal data (operator names, and in some cases patient-adjacent information in clinical manufacturing contexts). Under GDPR:</p>
<ul>
<li>Define and document the retention period for audio files before deployment</li>
<li>Audio files should be deleted on schedule; the hashed transcript in the audit record does not constitute personal data</li>
<li>If the pipeline processes any data that could be linked to a data subject (patients, trial participants), a data protection impact assessment (DPIA) is required</li>
</ul>
</section>
<section id="why-local-models-are-the-defensible-choice" class="level3">
<h3 class="anchored" data-anchor-id="why-local-models-are-the-defensible-choice">Why local models are the defensible choice</h3>
<p>Cloud ASR and LLM APIs are operationally convenient but introduce a data processor relationship that requires contractual governance. For most pharma R&amp;D environments, the path of least resistance is local: <code>faster-whisper</code> on a lab workstation or server, Ollama running a locally hosted model. No data leaves the network. The governance question reduces to “who has access to this server” rather than “what does the vendor’s data processing agreement permit.”</p>
<hr>
</section>
</section>
<section id="deployment-context" class="level2">
<h2 class="anchored" data-anchor-id="deployment-context">Deployment context</h2>
<p>The pipeline as described requires:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Minimum spec</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>faster-whisper</code> (medium model)</td>
<td>CPU-only: ~4 cores, 4GB RAM; processes 3-min audio in ~20s</td>
</tr>
<tr class="even">
<td><code>faster-whisper</code> (large-v3 model)</td>
<td>CPU-only: ~8 cores, 8GB RAM; GPU (4GB VRAM) for real-time</td>
</tr>
<tr class="odd">
<td>Ollama + llama3.1:8b</td>
<td>8GB RAM minimum; 16GB recommended for comfortable headroom</td>
</tr>
<tr class="even">
<td>Combined (medium ASR + 8B LLM)</td>
<td>16GB RAM, 4-core CPU — a standard lab workstation</td>
</tr>
</tbody>
</table>
<p>The simplest deployment: a dedicated lab workstation or small server with a shared network drive. Scientists drop audio files to a watched folder; the pipeline processes them and writes JSON output to an output folder. No web UI required for the MVP.</p>
<p>A web UI (Flask, FastAPI, or a simple Shiny/Streamlit interface) adds the review queue interface and removes the need for scientists to interact with the file system directly. This is the natural next step after the pipeline core is validated.</p>
<hr>
</section>
<section id="dos-and-donts" class="level2">
<h2 class="anchored" data-anchor-id="dos-and-donts">Do’s and don’ts</h2>
<section id="do" class="level3">
<h3 class="anchored" data-anchor-id="do">Do</h3>
<ul>
<li><strong>Define your Pydantic schema before writing any prompts.</strong> The schema is the specification. Prompts should be written to fill the schema, not the other way around.</li>
<li><strong>Keep the raw ASR transcript alongside every structured record.</strong> It is your evidence trail. If an extracted value is ever challenged, the transcript is what you go back to.</li>
<li><strong>Use a controlled vocabulary (enums) for all categorical fields.</strong> Free-text appearance descriptions will diverge within weeks of deployment.</li>
<li><strong>Set a confidence threshold and build the review queue before going live.</strong> “We’ll add that later” means it never gets added.</li>
<li><strong>Version-lock both the ASR model and the LLM.</strong> Treat model updates as change control events.</li>
<li><strong>Train operators on structured dictation.</strong> A short checklist (“state batch ID, then measurement, then deviations”) dramatically reduces missing mandatory fields.</li>
</ul>
</section>
<section id="dont" class="level3">
<h3 class="anchored" data-anchor-id="dont">Don’t</h3>
<ul>
<li><strong>Do not send audio recordings to cloud APIs without a data processing agreement and legal clearance.</strong> This applies to OpenAI Whisper API, Deepgram, AssemblyAI, and any other cloud ASR service.</li>
<li><strong>Do not auto-commit records with missing mandatory fields or implausible values.</strong> The review gate exists to catch extraction errors before they reach the ELN.</li>
<li><strong>Do not treat the structured output as authoritative over the raw transcript.</strong> The transcript is the source of truth; the JSON is a derived representation.</li>
<li><strong>Do not skip operator training.</strong> The pipeline can handle hedged and incomplete speech, but structured dictation habits reduce the volume of records requiring human review by 60–80% in practice.</li>
<li><strong>Do not update models without revalidation.</strong> A new model version is a new system. It requires qualification testing before deployment in a regulated context.</li>
</ul>
<hr>
</section>
</section>
<section id="full-runnable-example" class="level2">
<h2 class="anchored" data-anchor-id="full-runnable-example">Full runnable example</h2>
<p>The following is a minimal end-to-end implementation. It is intentionally simplified and generic. Production deployments require environment-specific schema design, domain validation rules, prompt libraries, and integration adapters not shown here.</p>
<section id="dependencies-pyproject.toml" class="level3">
<h3 class="anchored" data-anchor-id="dependencies-pyproject.toml">Dependencies (<code>pyproject.toml</code>)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb8-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"voice-to-data"</span></span>
<span id="cb8-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<span id="cb8-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=3.11"</span></span>
<span id="cb8-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"faster-whisper&gt;=1.0.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"instructor&gt;=1.3.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pydantic&gt;=2.0.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama&gt;=0.2.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.uv]</span></span>
<span id="cb8-13"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dev-dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ruff&gt;=0.3.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
<p>Install with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> sync</span></code></pre></div></div>
</section>
<section id="pipeline-pipeline.py" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-pipeline.py">Pipeline (<code>pipeline.py</code>)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Voice-to-data pipeline: audio file → structured lab observation.</span></span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">IMPORTANT: This is a simplified, illustrative implementation. It is not a</span></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">production system. Domain-specific schemas, prompt engineering, validation</span></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">rules, and LIMS integration are project-specific and not included here.</span></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb10-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb10-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> uuid</span>
<span id="cb10-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timezone</span>
<span id="cb10-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb10-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional</span>
<span id="cb10-15"></span>
<span id="cb10-16"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> instructor</span>
<span id="cb10-17"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> faster_whisper <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> WhisperModel</span>
<span id="cb10-18"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ollama <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Client</span>
<span id="cb10-19"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseModel, Field</span>
<span id="cb10-20"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> field_validator</span>
<span id="cb10-21"></span>
<span id="cb10-22"></span>
<span id="cb10-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ── Schema ────────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-24"></span>
<span id="cb10-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> LabObservation(BaseModel):</span>
<span id="cb10-26">    sample_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-27">    batch_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-28">    operator_id: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-29">    stated_timestamp: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-30">    measurement_type: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-31">    value: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-32">    unit: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-33">    appearance: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-34">    ingredient_added: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-35">    ingredient_quantity: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-36">    ingredient_unit: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-37">    deviation_flag: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb10-38">    hedged: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb10-39">    notes: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Field(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-40"></span>
<span id="cb10-41"></span>
<span id="cb10-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ── ASR ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-43"></span>
<span id="cb10-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> transcribe(audio_path: Path, model_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb10-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Transcribe an audio file using faster-whisper."""</span></span>
<span id="cb10-46">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> WhisperModel(model_size, device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span>, compute_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"int8"</span>)</span>
<span id="cb10-47">    segments, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.transcribe(</span>
<span id="cb10-48">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(audio_path),</span>
<span id="cb10-49">        initial_prompt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Formulation lab note. batch ID, pH, viscosity mPa·s, carbomer, excipient."</span>,</span>
<span id="cb10-50">    )</span>
<span id="cb10-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>.join(segment.text.strip() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> segment <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> segments)</span>
<span id="cb10-52"></span>
<span id="cb10-53"></span>
<span id="cb10-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ── Extraction ─────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-55"></span>
<span id="cb10-56">SYSTEM_PROMPT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">You are a laboratory data extraction assistant. Extract structured observations</span></span>
<span id="cb10-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">from voice transcripts of pharmaceutical formulation bench notes.</span></span>
<span id="cb10-59"></span>
<span id="cb10-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Rules:</span></span>
<span id="cb10-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- Extract only what is explicitly stated. Set missing fields to null.</span></span>
<span id="cb10-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- If a value is hedged ("approximately", "about", "maybe"), set hedged=true.</span></span>
<span id="cb10-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- Map appearance descriptions to clear, standardized terms.</span></span>
<span id="cb10-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- If multiple measurements are stated, capture the primary one and note the rest.</span></span>
<span id="cb10-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-66"></span>
<span id="cb10-67"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> extract(transcript: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> LabObservation:</span>
<span id="cb10-68">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Extract a structured observation from a raw transcript."""</span></span>
<span id="cb10-69">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> instructor.from_ollama(</span>
<span id="cb10-70">        Client(host<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span>),</span>
<span id="cb10-71">        mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>instructor.Mode.JSON,</span>
<span id="cb10-72">    )</span>
<span id="cb10-73">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> client.chat.completions.create(</span>
<span id="cb10-74">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llama3.1:8b"</span>,</span>
<span id="cb10-75">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb10-76">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: SYSTEM_PROMPT},</span>
<span id="cb10-77">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Extract from:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>transcript<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>},</span>
<span id="cb10-78">        ],</span>
<span id="cb10-79">        response_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LabObservation,</span>
<span id="cb10-80">    )</span>
<span id="cb10-81"></span>
<span id="cb10-82"></span>
<span id="cb10-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ── Validation ─────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-84"></span>
<span id="cb10-85"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> validate(obs: LabObservation) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb10-86">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Return a list of validation flags. Empty list means clean."""</span></span>
<span id="cb10-87">    flags <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-88">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> mandatory <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"batch_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"operator_id"</span>]:</span>
<span id="cb10-89">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(obs, mandatory) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb10-90">            flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"MISSING_MANDATORY_FIELD:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mandatory<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-91">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.measurement_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pH"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> obs.value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb10-92">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> obs.value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.0</span>):</span>
<span id="cb10-93">            flags.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IMPLAUSIBLE_PH:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-94">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> obs.hedged:</span>
<span id="cb10-95">        flags.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEDGED_VALUE:confirm_with_operator"</span>)</span>
<span id="cb10-96">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> flags</span>
<span id="cb10-97"></span>
<span id="cb10-98"></span>
<span id="cb10-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ── Pipeline ──────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-100"></span>
<span id="cb10-101"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run(audio_path: Path, output_path: Path) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb10-102">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Run the full pipeline for a single audio file."""</span></span>
<span id="cb10-103">    run_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"run_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datetime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>now(timezone.utc)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%Y%m</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_%H%M%S'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>uuid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>uuid4()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hex</span>[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb10-104"></span>
<span id="cb10-105">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stage 1: ASR</span></span>
<span id="cb10-106">    transcript <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> transcribe(audio_path)</span>
<span id="cb10-107"></span>
<span id="cb10-108">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stage 2: Extraction</span></span>
<span id="cb10-109">    observation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract(transcript)</span>
<span id="cb10-110"></span>
<span id="cb10-111">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stage 3: Validation</span></span>
<span id="cb10-112">    flags <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> validate(observation)</span>
<span id="cb10-113">    requires_review <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(flags) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-114">    hard_fail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(f.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IMPLAUSIBLE"</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> flags)</span>
<span id="cb10-115">    commit_status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rejected"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> hard_fail <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pending_review"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> requires_review <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"committed"</span>)</span>
<span id="cb10-116"></span>
<span id="cb10-117">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stage 4: Serialize</span></span>
<span id="cb10-118">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb10-119">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observation"</span>: observation.model_dump(),</span>
<span id="cb10-120">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"audit"</span>: {</span>
<span id="cb10-121">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pipeline_run_id"</span>: run_id,</span>
<span id="cb10-122">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"audio_file"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(audio_path),</span>
<span id="cb10-123">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asr_model"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"faster-whisper:medium"</span>,</span>
<span id="cb10-124">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm_model"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama:llama3.1:8b"</span>,</span>
<span id="cb10-125">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_transcript_sha256"</span>: hashlib.sha256(transcript.encode()).hexdigest(),</span>
<span id="cb10-126">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extraction_timestamp"</span>: datetime.now(timezone.utc).isoformat(),</span>
<span id="cb10-127">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"validation_flags"</span>: flags,</span>
<span id="cb10-128">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"review_required"</span>: requires_review,</span>
<span id="cb10-129">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commit_status"</span>: commit_status,</span>
<span id="cb10-130">        },</span>
<span id="cb10-131">    }</span>
<span id="cb10-132"></span>
<span id="cb10-133">    output_path.write_text(json.dumps(result, indent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ensure_ascii<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>))</span>
<span id="cb10-134">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>commit_status<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>upper()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>run_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-135">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> flags:</span>
<span id="cb10-136">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> flag <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> flags:</span>
<span id="cb10-137">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  ⚠ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>flag<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-138"></span>
<span id="cb10-139"></span>
<span id="cb10-140"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb10-141">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb10-142">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(sys.argv) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:</span>
<span id="cb10-143">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage: uv run pipeline.py &lt;audio_file&gt; &lt;output_json&gt;"</span>)</span>
<span id="cb10-144">        sys.exit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-145">    run(Path(sys.argv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), Path(sys.argv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span></code></pre></div></div>
<p>Run with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> run pipeline.py bench_note_20260222.mp3 observation_F204.json</span></code></pre></div></div>
<hr>
</section>
</section>
<section id="where-this-goes-next" class="level2">
<h2 class="anchored" data-anchor-id="where-this-goes-next">Where this goes next</h2>
<p>The pipeline described here is the core. What makes it useful in practice is what wraps it:</p>
<ul>
<li><strong>A review UI</strong>: a minimal web interface where lab supervisors see flagged records, listen to the audio, and approve or edit before commit. This is where the GxP compliance story completes.</li>
<li><strong>Operator feedback loop</strong>: when a record is frequently flagged for the same reason (operator always forgets to state the batch ID), the review system should surface this pattern so training can be adjusted.</li>
<li><strong>Multi-observation sessions</strong>: a single bench session produces many observations. Batching them into a session record, with cross-observation consistency checks (does the batch ID stay the same throughout?), is a natural extension.</li>
<li><strong>Domain fine-tuning</strong>: for high-volume deployments, fine-tuning Whisper on your specific compound vocabulary eliminates the most common ASR errors and reduces the downstream extraction burden.</li>
</ul>
<p>The friction this solves is real and measurable. The compliance overhead of solving it properly is also real. Neither should be understated. The value is in removing the keyboard from the critical path of scientific observation — and doing it in a way that produces data you can actually defend.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>LLM</category>
  <category>Speech</category>
  <category>NLP</category>
  <category>Data Pipeline</category>
  <category>Lab Automation</category>
  <guid>https://antoinelucasfra.github.io/posts/voice-to-data-lab-pipeline/</guid>
  <pubDate>Sat, 21 Feb 2026 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Reproducible Environments for Everyone: DevContainers for Data Science Teams</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/devcontainers-reproducible-environments/</link>
  <description><![CDATA[ 





<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The problem</h2>
<p>“It works on my machine” is an old joke in software engineering. In data science teams it’s still a weekly occurrence, and it’s worse because the people affected are often not software engineers. A biostatistician or computational biologist should not need to spend two hours debugging a Quarto render failure caused by a missing system dependency or a mismatched R version.</p>
<p>The gap between “the analysis worked on the statistician’s laptop” and “the analysis can be reproduced six months later by a different person” is a real reproducibility problem in R&amp;D contexts. <code>renv</code> locks R packages. <code>uv</code> locks Python packages. But neither handles the runtime environment: R version, system libraries, Quarto CLI version, or the formatter that enforces code style.</p>
<p>DevContainers solve this layer. Every team member opens the project and gets exactly the same environment — the same R version, the same tools, the same VS Code configuration — in one click, without any manual setup.</p>
<hr>
</section>
<section id="terminology" class="level2">
<h2 class="anchored" data-anchor-id="terminology">Terminology</h2>
<p>A <strong>devcontainer</strong> is a Docker container configured specifically for development. The <a href="https://containers.dev/">Dev Container specification</a> defines a <code>devcontainer.json</code> file that tells VS Code (or any compatible tool) how to build or pull a container image and configure the development environment inside it.</p>
<p>Key concepts:</p>
<ul>
<li><strong><code>devcontainer.json</code></strong> — the configuration file at <code>.devcontainer/devcontainer.json</code>. Specifies the image, features to install, VS Code extensions, and editor settings.</li>
<li><strong>Devcontainer features</strong> — composable installation units. Each feature is a self-contained script that installs a specific tool or set of tools into the container. Features can be published to GitHub Container Registry (GHCR) or kept as local scripts.</li>
<li><strong>Pre-built image vs.&nbsp;build-on-open</strong> — you can either reference a pre-built Docker image (<code>"image": "ghcr.io/..."</code>) or define a <code>Dockerfile</code> and build the image when the devcontainer opens. Pre-built is faster and more reproducible; build-on-open is useful during development of the image itself.</li>
</ul>
<hr>
</section>
<section id="pre-built-image-strategy" class="level2">
<h2 class="anchored" data-anchor-id="pre-built-image-strategy">Pre-built image strategy</h2>
<p>The most important decision in a devcontainer setup for a team is: <strong>pre-build the image</strong>. If every team member rebuilds the image on first open, you pay the build cost repeatedly (10–20 minutes for a full R + Python image is not unusual), and you risk divergence when upstream base images change.</p>
<p>The strategy:</p>
<ol type="1">
<li>Define a <code>Dockerfile</code> — often a single line</li>
<li>Configure a continuous integration (CI) workflow that builds and pushes the image to GHCR on changes to <code>.devcontainer/**</code></li>
<li>Reference the pre-built image in <code>devcontainer.json</code> with a <code>build</code> fallback for first-time setup</li>
</ol>
<p>The <code>Dockerfile</code> for this setup is literally one line (plus a build arg for flexibility):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ARG</span> IMAGE=ghcr.io/r-lib/rig/r:latest</span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> ${IMAGE}</span></code></pre></div></div>
<p>The base image (<code>ghcr.io/r-lib/rig/r:latest</code>) is maintained by the <code>rig</code> project and provides a clean Ubuntu image with R installed via <code>rig</code>. Everything else — Quarto, Python, uv, air, R packages — is layered on by devcontainer features.</p>
<p>The CI workflow (<code>.github/workflows/build-push.yml</code>) handles building and publishing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode yaml code-annotation-code code-with-copy code-annotated"><code class="sourceCode yaml"><span id="annotated-cell-2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Build and push devcontainer image</span></span>
<span id="annotated-cell-2-2"></span>
<span id="annotated-cell-2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-6" class="code-annotation-target"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paths</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".devcontainer/**"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="annotated-cell-2-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow_dispatch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-8"></span>
<span id="annotated-cell-2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build-and-push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="annotated-cell-2-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">permissions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> read</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2">2</button><span id="annotated-cell-2-14" class="code-annotation-target"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">packages</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> write</span></span>
<span id="annotated-cell-2-15"></span>
<span id="annotated-cell-2-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v4</span></span>
<span id="annotated-cell-2-18"></span>
<span id="annotated-cell-2-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Set up Docker Buildx</span></span>
<span id="annotated-cell-2-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/setup-buildx-action@v3</span></span>
<span id="annotated-cell-2-21"></span>
<span id="annotated-cell-2-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Log in to GHCR</span></span>
<span id="annotated-cell-2-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/login-action@v3</span></span>
<span id="annotated-cell-2-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ghcr.io</span></span>
<span id="annotated-cell-2-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">username</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ github.actor }}</span></span>
<span id="annotated-cell-2-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">password</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="annotated-cell-2-28"></span>
<span id="annotated-cell-2-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Extract metadata</span></span>
<span id="annotated-cell-2-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> meta</span></span>
<span id="annotated-cell-2-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/metadata-action@v5</span></span>
<span id="annotated-cell-2-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">images</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ghcr.io/antoinelucasfra/quarto-devcontainer</span></span>
<span id="annotated-cell-2-34"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">          tags</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="annotated-cell-2-35">            type=raw,value=latest,enable={{is_default_branch}}</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3">3</button><span id="annotated-cell-2-36" class="code-annotation-target">            type=sha,prefix=sha-</span>
<span id="annotated-cell-2-37"></span>
<span id="annotated-cell-2-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Build and push</span></span>
<span id="annotated-cell-2-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/build-push-action@v6</span></span>
<span id="annotated-cell-2-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="annotated-cell-2-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">context</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> .devcontainer</span></span>
<span id="annotated-cell-2-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> .devcontainer/Dockerfile</span></span>
<span id="annotated-cell-2-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build-args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> IMAGE=ghcr.io/r-lib/rig/r:latest</span></span>
<span id="annotated-cell-2-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="annotated-cell-2-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tags</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="annotated-cell-2-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.meta.outputs.labels }}</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4">4</button><span id="annotated-cell-2-47" class="code-annotation-target"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cache-from</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> type=gha</span></span>
<span id="annotated-cell-2-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cache-to</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> type=gha,mode=max</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5">5</button><span id="annotated-cell-2-49" class="code-annotation-target"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">platforms</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> linux/amd64,linux/arm64</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="6" data-code-annotation="1">Only rebuild the image when files under <code>.devcontainer/</code> change — avoids unnecessary builds on every commit.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="14" data-code-annotation="2"><code>packages: write</code> permission is required to push the image to GitHub Container Registry (GHCR).</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="36" data-code-annotation="3">Generate an immutable SHA-tagged image in addition to <code>latest</code> — use the SHA tag when you need a pinned, auditable reference.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="47" data-code-annotation="4">Cache Docker layer builds in GitHub Actions — dramatically reduces rebuild time on incremental changes (typically 15 min → 2–3 min).</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="49" data-code-annotation="5">Build for both Intel/AMD (<code>amd64</code>) and Apple Silicon (<code>arm64</code>) in one pass — team members on different hardware get a native image without emulation.</span>
</dd>
</dl>
<p>A few things worth noting:</p>
<ul>
<li><strong>Multi-platform build</strong> (<code>linux/amd64,linux/arm64</code>) ensures the image works on both Intel/AMD machines and Apple Silicon Macs without emulation.</li>
<li><strong>GitHub Actions (GHA) layer cache</strong> (<code>cache-from/to: type=gha</code>) cuts rebuild time significantly — typically from 15+ minutes to 2–3 minutes on incremental changes.</li>
<li><strong>SHA tags</strong> (<code>type=sha,prefix=sha-</code>) give you immutable image references for pinning. <code>latest</code> is convenient; <code>sha-abc1234</code> is reproducible.</li>
</ul>
<hr>
</section>
<section id="custom-local-feature" class="level2">
<h2 class="anchored" data-anchor-id="custom-local-feature">Custom local feature</h2>
<p>The devcontainer features ecosystem has hundreds of published features for common tools. But for project-specific combinations, a <strong>local feature</strong> — stored in your repository under <code>./features/</code> — is the right approach. It gives you full control without the overhead of publishing to GHCR.</p>
<p>My local feature (<code>./features/quarto-computing-dependencies</code>) installs the full computing stack needed for Quarto-based R + Python data science:</p>
<ul>
<li><strong>uv</strong> — Python package manager (Astral). Installed system-wide to <code>/usr/local/bin</code>.</li>
<li><strong>air</strong> — R formatter CLI (Posit). The same formatter the VS Code extension uses, available in the terminal and CI.</li>
<li><strong>jarl</strong> — R linter CLI. Lightweight, fast, pairs well with air.</li>
<li><strong>R packages</strong> — installed via <code>pak</code>, supports both Comprehensive R Archive Network (CRAN) names and GitHub refs (<code>user/repo@tag</code>).</li>
<li><strong>Python packages</strong> — installed system-wide via <code>uv pip install --system</code>.</li>
</ul>
<p>The feature’s <code>devcontainer-feature.json</code> defines its options:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-3-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto-computing-dependencies"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2.0.0"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Install Computing Dependencies for Quarto"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"options"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-3-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"rDeps"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-3-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rmarkdown"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-9" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comma-separated R packages to install via pak. Supports CRAN names and GitHub refs."</span></span>
<span id="annotated-cell-3-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-3-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"pythonDeps"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-3-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jupyter,papermill,marimo"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-14" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comma-separated Python packages to install via uv pip install --system."</span></span>
<span id="annotated-cell-3-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-16" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"uvVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-3-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"airVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-3-18">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"jarlVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-3-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="9" data-code-annotation="1"><code>rDeps</code> accepts a comma-separated list — CRAN package names or GitHub refs like <code>user/repo@tag</code>. Passed directly to <code>pak::pkg_install()</code> in <code>install.sh</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="14" data-code-annotation="2"><code>pythonDeps</code> are installed system-wide via <code>uv pip install --system</code> — available to all users in the container, not just a virtual environment.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="16" data-code-annotation="3">Tool versions default to <code>latest</code> — override in <code>devcontainer.json</code> to pin to a specific release for a reproducible build.</span>
</dd>
</dl>
<p>And the installation is handled by <code>install.sh</code>. The R package installation step shows the pattern:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_r_deps()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-2" class="code-annotation-target">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">deps</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span></span>
<span id="annotated-cell-4-3">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">r_vec</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-4" class="code-annotation-target">  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">r_vec</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${deps}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/,/","/g'</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-5" class="code-annotation-target">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">su</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${USERNAME}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rscript -e 'pak::pkg_install(c(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${r_vec}</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">), upgrade = FALSE)'"</span></span>
<span id="annotated-cell-4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="1"><code>deps</code> receives the comma-separated string from <code>devcontainer.json</code> options (e.g.&nbsp;<code>"dplyr,ggplot2"</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="4" data-code-annotation="2">Transforms <code>a,b,c</code> into <code>"a","b","c"</code> — the format <code>pak::pkg_install()</code> expects as an R character vector.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="5" data-code-annotation="3">Runs as the non-root <code>vscode</code> user, not root — prevents R packages landing in the system library where they would conflict with <code>renv</code>.</span>
</dd>
</dl>
<p>Installing as the non-root remote user (<code>su "${USERNAME}"</code>) matters here — R packages installed as root end up in a system library that can conflict with <code>renv</code>.</p>
<p>The composability is the main benefit of the feature pattern. You can use this same feature across different projects, passing different <code>rDeps</code> and <code>pythonDeps</code> strings without duplicating installation logic.</p>
<hr>
</section>
<section id="devcontainer.json-walkthrough" class="level2">
<h2 class="anchored" data-anchor-id="devcontainer.json-walkthrough"><code>devcontainer.json</code> walkthrough</h2>
<p>Here is the full <code>devcontainer.json</code> for this setup:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-5" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quarto R+Python"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-3" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"image"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ghcr.io/antoinelucasfra/quarto-devcontainer:latest"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"build"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dockerfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dockerfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"args"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"IMAGE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ghcr.io/r-lib/rig/r:latest"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-5-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"remoteUser"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"features"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"./features/quarto-computing-dependencies"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-12" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"rDeps"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rmarkdown,knitr,languageserver,nx10/httpgd@v2.0.3,prompt,tidyverse,ggplot2,gt"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"pythonDeps"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jupyter,papermill,marimo,marimo[recommended]"</span></span>
<span id="annotated-cell-5-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-5-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer-features/quarto-cli:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"release"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"installTinyTex"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"true"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"installChromium"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"false"</span></span>
<span id="annotated-cell-5-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-5-21">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customizations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-22">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-23">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-5-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto.quarto"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mcanouil.quarto-wizard"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-25">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REditorSupport.r"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posit.air-vscode"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-python.python"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliermarsh.ruff"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"astral-sh.ty"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-27">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-toolsai.jupyter"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"marimo-team.vscode-marimo"</span></span>
<span id="annotated-cell-5-28">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-29">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"settings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-30" class="code-annotation-target">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"r.useRenvLibPath"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-31">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"[r]"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-32">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.defaultFormatter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posit.air-vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-33">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.formatOnSave"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="annotated-cell-5-34">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-5-35">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"[python]"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-5-36">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.defaultFormatter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliermarsh.ruff"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-37">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.formatOnSave"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="annotated-cell-5-38">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-5-39">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"python.defaultInterpreterPath"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"${workspaceFolder}/.venv/bin/python"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="4">4</button><span id="annotated-cell-5-40" class="code-annotation-target">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.rulers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-5-41">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-5-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-5-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-5-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="3" data-code-annotation="1">Use the pre-built image from GHCR — fast startup. The <code>"build"</code> block below is a local fallback if the image pull fails.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="12" data-code-annotation="2">Pass the R package list directly to the local feature — supports GitHub refs (<code>nx10/httpgd@v2.0.3</code>) alongside CRAN names.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="30" data-code-annotation="3">Tell the R VS Code extension to load packages from the project’s <code>renv</code> library — keeps IntelliSense in sync with <code>renv::restore()</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="40" data-code-annotation="4">Ruler at column 72 — a conservative line-length suitable for code that appears in Quarto documents and PDF output.</span>
</dd>
</dl>
<p>Key choices:</p>
<ul>
<li><code>"image"</code> references the pre-built image. The <code>"build"</code> block is a fallback — if the image pull fails (first-time setup, network issue), VS Code falls back to building locally.</li>
<li><code>"remoteUser": "vscode"</code> — the non-root user that runs in the container. R packages and uv installs respect this.</li>
<li>The <code>quarto-cli</code> feature installs TinyTeX (<code>installTinyTex: "true"</code>) so PDF output works without any additional setup.</li>
<li><code>"r.useRenvLibPath": true</code> — tells the R VS Code extension to use the project’s <code>renv</code> library, so <code>renv::restore()</code> and the extension’s package index stay in sync.</li>
<li>Format-on-save is enabled for both R (air) and Python (ruff). This is not optional — it enforces consistent style automatically without anyone having to think about it.</li>
</ul>
<hr>
</section>
<section id="making-it-work-for-non-developers" class="level2">
<h2 class="anchored" data-anchor-id="making-it-work-for-non-developers">Making it work for non-developers</h2>
<p>The setup above sounds like a lot of infrastructure. The experience from the user’s side is:</p>
<ol type="1">
<li>Install VS Code and the Dev Containers extension (<code>ms-vscode-remote.remote-containers</code>).</li>
<li>Install Docker Desktop.</li>
<li>Open the project folder in VS Code.</li>
<li>Click “Reopen in Container” when prompted.</li>
<li>Wait ~2 minutes for the pre-built image to pull and features to install (first time only; subsequent opens are instant).</li>
<li>Work normally.</li>
</ol>
<p>That’s it. No <code>install.packages()</code>, no Python virtualenv management, no Quarto CLI version mismatch, no TinyTeX setup. The environment is identical to everyone else’s on the team.</p>
<p>For a team of biostatisticians or computational biologists who are comfortable with R but not with devops tooling, this is a significant reduction in onboarding friction. The alternative is a 10-page “Environment Setup” document that is never fully correct.</p>
<hr>
</section>
<section id="cicd-continuous-integrationcontinuous-deployment-for-the-image" class="level2">
<h2 class="anchored" data-anchor-id="cicd-continuous-integrationcontinuous-deployment-for-the-image">CI/CD (continuous integration/continuous deployment) for the image</h2>
<p>The <code>build-push.yml</code> workflow deserves a closer look, because this is where the reproducibility guarantee is maintained over time.</p>
<p>The workflow triggers on any change to <code>.devcontainer/**</code> — meaning whenever you update <code>devcontainer.json</code>, the <code>Dockerfile</code>, or the local feature scripts, a new image is built and pushed. Team members get the updated environment on their next container rebuild.</p>
<p>The multi-platform build (<code>linux/amd64,linux/arm64</code>) handles the growing heterogeneity of developer hardware. If you skip this, Apple Silicon users either get emulation (slow) or a different image (not reproducible). Buildx with <code>docker/build-push-action@v6</code> handles cross-compilation transparently.</p>
<p>GHA layer caching (<code>type=gha</code>) is essential for iteration speed. The base image layers are cached; only the changed layers rebuild. A change to <code>install.sh</code> that only modifies the R package list typically rebuilds in under 3 minutes rather than 15.</p>
<hr>
</section>
<section id="practical-tips" class="level2">
<h2 class="anchored" data-anchor-id="practical-tips">Practical tips</h2>
<p><strong>Pin image tags in production.</strong> The <code>devcontainer.json</code> above uses <code>latest</code>. This is convenient for development — you always get the newest image. For a project that needs to be reproducible for audit or regulatory purposes, pin to a SHA tag:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"image":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/antoinelucasfra/quarto-devcontainer:sha-abc1234"</span></span></code></pre></div></div>
<p>SHA tags are generated automatically by <code>docker/metadata-action</code> on every build. Find the right tag in your GHCR package page.</p>
<p><strong>Test with the <code>devcontainer</code> CLI.</strong> Before pushing changes to the feature or image, test locally:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> @devcontainers/cli</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">devcontainer</span> build <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-folder</span> .</span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">devcontainer</span> up <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-folder</span> .</span></code></pre></div></div>
<p>This catches errors in <code>install.sh</code> without triggering a full CI build.</p>
<p><strong>Iterate on the feature without rebuilding the full image.</strong> If you’re modifying <code>install.sh</code> frequently, comment out the <code>"image"</code> line temporarily and use only the <code>"build"</code> block. This rebuilds from the base image each time, which is slower but lets you test feature changes without publishing to GHCR.</p>
<p><strong>Keep <code>renv.lock</code> and the devcontainer in sync.</strong> The devcontainer installs a baseline set of R packages. Project-specific packages live in <code>renv.lock</code>. When <code>renv::restore()</code> runs inside the container, it installs on top of the baseline. This separation works well — the baseline handles heavy system dependencies (like <code>tidyverse</code>, which takes several minutes to compile from source), while <code>renv</code> handles project-specific versioned packages quickly.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>DevContainers</category>
  <category>Docker</category>
  <category>R</category>
  <category>Python</category>
  <category>Reproducibility</category>
  <category>VS Code</category>
  <guid>https://antoinelucasfra.github.io/posts/devcontainers-reproducible-environments/</guid>
  <pubDate>Thu, 27 Nov 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>LLM-Assisted Development: A Data Scientist’s Field Guide</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/llm-coding-assistant/</link>
  <description><![CDATA[ 





<section id="honest-preamble" class="level2">
<h2 class="anchored" data-anchor-id="honest-preamble">Honest preamble</h2>
<p>This is not a “become a 10x developer with AI” post. I’ve been using large language model (LLM)-assisted tools daily for over a year across pharma, biotech, and cosmetics R&amp;D contexts, and the reality is more nuanced than the hype suggests.</p>
<p>The genuine gains: faster boilerplate, quicker navigation of unfamiliar APIs, less context-switching when writing documentation. The real failure modes: overconfidence in generated statistical logic, package version hallucinations, and a subtle drift toward writing code you don’t fully understand because it looked plausible.</p>
<p>My stack has settled into three layers, each with a different trust level and appropriate use case. I’ll walk through each one, then close with the things I’ve learned not to delegate to a model.</p>
<hr>
</section>
<section id="the-three-layer-stack" class="level2">
<h2 class="anchored" data-anchor-id="the-three-layer-stack">The three-layer stack</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Layer</th>
<th>Tool</th>
<th>Trust level</th>
<th>Best for</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Inline completion</td>
<td>GitHub Copilot</td>
<td>Medium</td>
<td>Boilerplate, repetitive patterns, docstrings</td>
</tr>
<tr class="even">
<td>Agentic / repo-level</td>
<td><a href="https://opencode.ai">OpenCode</a></td>
<td>Medium-High</td>
<td>Scaffolding, refactoring, multi-file tasks</td>
</tr>
<tr class="odd">
<td>Local / private</td>
<td>Ollama + Continue</td>
<td>Low-Medium</td>
<td>Sensitive data contexts, offline work</td>
</tr>
</tbody>
</table>
<p>Each layer has a different footprint. Copilot is always on — it suggests as you type. OpenCode operates at the repository level, understanding file structure and multi-step tasks. Ollama stays on-device, which matters when you’re working with patient data or proprietary formulations.</p>
<hr>
</section>
<section id="github-copilot" class="level2">
<h2 class="anchored" data-anchor-id="github-copilot">GitHub Copilot</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Install two extensions in VS Code:</p>
<ul>
<li><code>GitHub.copilot</code> — inline completions</li>
<li><code>GitHub.copilot-chat</code> — sidebar chat and inline <code>/explain</code>, <code>/fix</code>, <code>/doc</code></li>
</ul>
<p>That’s it. The defaults are good. The one thing worth doing immediately is writing a <code>.github/copilot-instructions.md</code> file at your project root.</p>
</section>
<section id="copilot-instructions.md" class="level3">
<h3 class="anchored" data-anchor-id="copilot-instructions.md"><code>copilot-instructions.md</code></h3>
<p>This file is the most underused feature of Copilot. It is injected into every chat prompt and shapes completions without you having to re-explain context. For a typical R + Python data science project, mine looks like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-annotation-code code-with-copy code-annotated"><code class="sourceCode markdown"><span id="annotated-cell-1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># Project: Ingredient Efficacy Analysis</span></span>
<span id="annotated-cell-1-2"></span>
<span id="annotated-cell-1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Context</span></span>
<span id="annotated-cell-1-4">Biostatistics project for L'Oréal R&amp;D.</span>
<span id="annotated-cell-1-5">R (primary) + Python (secondary, ML pipeline).</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-6" class="code-annotation-target">Regulated context: results feed into regulatory submissions.</span>
<span id="annotated-cell-1-7"></span>
<span id="annotated-cell-1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## R conventions</span></span>
<span id="annotated-cell-1-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>tidyverse style throughout</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-10" class="code-annotation-target"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Use <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`air`</span> for formatting (never <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`styler`</span>)</span>
<span id="annotated-cell-1-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Package management: <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`renv`</span> — always <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`renv::snapshot()`</span> after install</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-12" class="code-annotation-target"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Statistical tests: mixed models via <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`lme4`</span>/<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`nlme`</span>, never base <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`aov()`</span> for repeated measures</span>
<span id="annotated-cell-1-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Report with <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`quarto`</span> — <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`.qmd`</span> files, never <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`.Rmd`</span></span>
<span id="annotated-cell-1-14"></span>
<span id="annotated-cell-1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Python conventions</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-16" class="code-annotation-target"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`uv`</span> for dependency management (never <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`pip install`</span> directly)</span>
<span id="annotated-cell-1-17"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`ruff`</span> for formatting and linting</span>
<span id="annotated-cell-1-18"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Type hints on all function signatures</span>
<span id="annotated-cell-1-19"></span>
<span id="annotated-cell-1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## What NOT to do</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5">5</button><span id="annotated-cell-1-21" class="code-annotation-target"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never suggest <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`p.adjust()`</span> without context — ask which correction is appropriate</span>
<span id="annotated-cell-1-22"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never suggest <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`lm()`</span> on repeated measures data without flagging the assumption violation</span>
<span id="annotated-cell-1-23"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never install packages outside of <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`renv::install()`</span> / <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`uv add`</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="1">Regulatory context flag — Copilot uses this to avoid suggesting cloud APIs or non-reproducible patterns that would be inappropriate in a submission context.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="10" data-code-annotation="2">Explicit formatter preference — prevents suggestions to use <code>styler</code>, which conflicts with <code>air</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="12" data-code-annotation="3">Force the right statistical approach for repeated measures — without this, Copilot frequently proposes <code>aov()</code> or <code>t.test()</code> on paired data.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="16" data-code-annotation="4">Lock down Python package management — prevents <code>pip install</code> suggestions that would bypass <code>uv</code>’s lockfile.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="21" data-code-annotation="5">Prevent uncontextualised multiple testing “fixes” — a critical guard for any analysis generating multiple p-values.</span>
</dd>
</dl>
<p>The effect is immediate. Copilot stops suggesting <code>library(ggplot2)</code> when you already have a <code>tidyverse</code> import pattern, and it stops proposing base R testing functions when your project conventions are explicit.</p>
</section>
<section id="inline-completions" class="level3">
<h3 class="anchored" data-anchor-id="inline-completions">Inline completions</h3>
<p>A few patterns that work well:</p>
<ul>
<li><strong>Data wrangling skeletons.</strong> Start typing <code>df |&gt; filter(</code> and Copilot will often complete the condition correctly from context. Accept with Tab, verify the column name.</li>
<li><strong>Test stubs.</strong> Write the function name and a comment like <code># Test: returns NA for empty input</code>, then let Copilot draft the <code>testthat::test_that()</code> block.</li>
<li><strong>Docstrings.</strong> Place the cursor above a function definition and type <code>#'</code> — Copilot completes the roxygen skeleton from the function signature.</li>
</ul>
</section>
<section id="where-copilot-earns-its-keep" class="level3">
<h3 class="anchored" data-anchor-id="where-copilot-earns-its-keep">Where Copilot earns its keep</h3>
<ul>
<li>Boilerplate ggplot2 themes and axis formatting</li>
<li><code>dplyr</code>/<code>tidyr</code> pipelines for reshaping</li>
<li>Writing repetitive unit tests once you’ve shown the pattern</li>
<li>SQL query generation from a clear English description</li>
</ul>
</section>
<section id="where-it-fails" class="level3">
<h3 class="anchored" data-anchor-id="where-it-fails">Where it fails</h3>
<ul>
<li><strong>Statistical model selection.</strong> Do not ask Copilot whether to use a mixed model or a generalized estimating equations (GEE) model for your longitudinal data. It will give you a plausible-sounding answer that may be wrong for your specific design. This requires domain judgment.</li>
<li><strong>P-value interpretation.</strong> I’ve seen Copilot generate commentary like “the result is highly significant (p = 0.03)” in a context where 0.03 is borderline given the multiple testing burden. It doesn’t know your correction strategy.</li>
<li><strong>Regulatory logic.</strong> Any code that feeds into a regulatory document needs human-authored logic. Don’t let Copilot scaffold the decision rules.</li>
</ul>
<div class="callout-warning-stat">
<p>A model completing your statistical code has no understanding of your study design, missing data mechanism, or correction strategy. Plausible-looking code that chooses the wrong model or misinterprets an effect size can pass code review and still produce wrong conclusions. Statistical judgment is not delegable to autocomplete.</p>
</div>
<hr>
</section>
</section>
<section id="opencode" class="level2">
<h2 class="anchored" data-anchor-id="opencode">OpenCode</h2>
<p><a href="https://opencode.ai">OpenCode</a> is a terminal-based agentic coding assistant. Where Copilot works at the line or block level, OpenCode operates across files and repositories. It can read your project structure, write new files, run commands, and execute multi-step tasks from a single prompt.</p>
<p>The key difference in practice: Copilot completes what you’re typing. OpenCode acts on what you describe.</p>
<section id="agents.md" class="level3">
<h3 class="anchored" data-anchor-id="agents.md"><code>AGENTS.md</code></h3>
<p>The same principle as <code>copilot-instructions.md</code> applies here, but with more scope. OpenCode reads <code>AGENTS.md</code> at the project root (and any subdirectory <code>AGENTS.md</code> files) to understand context, conventions, and constraints. A minimal but useful template:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># AGENTS.md</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Context</span></span>
<span id="cb1-4">R + Python data science project. Regulated context (pharma R&amp;D).</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Conventions</span></span>
<span id="cb1-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>R: tidyverse, air formatter, renv for packages</span>
<span id="cb1-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Python: uv, ruff, type hints</span>
<span id="cb1-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Git: conventional commits (feat/fix/docs/refactor/test/chore)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Hard rules</span></span>
<span id="cb1-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never install R packages without updating renv.lock</span>
<span id="cb1-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never edit files in docs/ — generated output only</span>
<span id="cb1-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never commit .Rhistory, .DS_Store, renv/library/</span>
<span id="cb1-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Statistical model selection is never delegated to AI</span></code></pre></div></div>
<p>This file is worth spending 20 minutes on at project start. It will save you from correcting the same mistakes across a hundred interactions.</p>
</section>
<section id="workflow-patterns-that-work" class="level3">
<h3 class="anchored" data-anchor-id="workflow-patterns-that-work">Workflow patterns that work</h3>
<ul>
<li><strong>Scaffolding a new module.</strong> “Create an R script that reads a CSV, validates column types, and returns a cleaned tibble. Use our standard error handling pattern from <code>R/utils.R</code>.” OpenCode reads <code>utils.R</code> and applies the pattern.</li>
<li><strong>Refactoring.</strong> “Refactor all uses of <code>read.csv()</code> to <code>readr::read_csv()</code> across the project, and update the function signatures to use <code>col_types</code> explicitly.” Multi-file, handles it.</li>
<li><strong>Test generation.</strong> “Write <code>testthat</code> tests for every exported function in <code>R/analysis.R</code>. Each test should cover the happy path and one edge case.”</li>
<li><strong>Documentation passes.</strong> “Add roxygen2 documentation to all undocumented functions in <code>R/</code>.”</li>
</ul>
</section>
<section id="when-copilot-is-better" class="level3">
<h3 class="anchored" data-anchor-id="when-copilot-is-better">When Copilot is better</h3>
<p>OpenCode has overhead. For single-line completions, tab-completing a dplyr pipeline, or quickly looking up a function signature — Copilot is faster. Use OpenCode when the task has enough scope that describing it in prose is more efficient than typing it yourself.</p>
<hr>
</section>
</section>
<section id="ollama" class="level2">
<h2 class="anchored" data-anchor-id="ollama">Ollama</h2>
<p>Ollama runs LLMs locally. No data leaves your machine. For teams working with clinical trial data, patient samples, proprietary formulations, or anything subject to General Data Protection Regulation (GDPR) or Good Practices (GxP) data governance, this matters.</p>
<p>Cloud LLM providers — including GitHub Copilot — process your code on external servers. In most enterprise pharma environments, this is either explicitly prohibited or sits in a legal grey zone. Ollama sidesteps this entirely.</p>
<section id="setup-1" class="level3">
<h3 class="anchored" data-anchor-id="setup-1">Setup</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install Ollama</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fsSL</span> https://ollama.com/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pull a model</span></span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ollama</span> pull deepseek-coder-v2</span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ollama</span> pull phi4</span></code></pre></div></div>
<p>Then install the <a href="https://www.continue.dev/">Continue</a> VS Code extension (<code>Continue.continue</code>) and add a model config to <code>.continue/config.json</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-4-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"models"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-4-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeepSeek Coder V2 (local)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-5" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"provider"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-6" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepseek-coder-v2"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-7" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiBase"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span></span>
<span id="annotated-cell-4-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-4-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-4-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Phi-4 (local)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-4-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"provider"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-4-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-4-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiBase"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span></span>
<span id="annotated-cell-4-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-4-15">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-4-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="5" data-code-annotation="1">Use the <code>ollama</code> provider — tells Continue to speak the Ollama API protocol instead of OpenAI’s.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="6" data-code-annotation="2">Model name exactly as it appears in <code>ollama list</code> — must match what you pulled.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="7" data-code-annotation="3">Default Ollama endpoint — all traffic stays on <code>localhost</code>, nothing leaves the machine.</span>
</dd>
</dl>
</section>
<section id="model-selection" class="level3">
<h3 class="anchored" data-anchor-id="model-selection">Model selection</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>Size</th>
<th>Good for</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>deepseek-coder-v2</code></td>
<td>16B</td>
<td>General coding, R, Python, SQL</td>
</tr>
<tr class="even">
<td><code>phi4</code></td>
<td>14B</td>
<td>Reasoning tasks, smaller footprint</td>
</tr>
<tr class="odd">
<td><code>llama3.2</code></td>
<td>3B</td>
<td>Fast completions on low-resource machines</td>
</tr>
</tbody>
</table>
</section>
<section id="the-honest-capability-gap" class="level3">
<h3 class="anchored" data-anchor-id="the-honest-capability-gap">The honest capability gap</h3>
<p>Local models at 14–16B parameters are meaningfully behind frontier cloud models (GPT-4o, Claude Sonnet) on complex reasoning, long-context tasks, and nuanced code generation. On a 16GB laptop, <code>deepseek-coder-v2</code> is noticeably slower than Copilot and produces more corrections-needed output.</p>
<p>The trade-off is clear: if your data governance constraints are real, the capability gap is the price you pay. For boilerplate generation on non-sensitive projects, the gap is small enough to be acceptable.</p>
<hr>
</section>
</section>
<section id="dos-and-donts" class="level2">
<h2 class="anchored" data-anchor-id="dos-and-donts">Do’s and don’ts</h2>
<section id="do" class="level3">
<h3 class="anchored" data-anchor-id="do">Do</h3>
<ul>
<li><strong>Write <code>AGENTS.md</code> and <code>copilot-instructions.md</code> before writing any prompts.</strong> Five minutes of upfront context saves hours of correction downstream.</li>
<li><strong>Use AI for the first 80% of boilerplate.</strong> The last 20% — the logic that’s specific to your domain — write yourself.</li>
<li><strong>Read every diff before accepting.</strong> Every single one. This is not optional. Models produce plausible-looking errors.</li>
<li><strong>Write your tests against your own spec, then use AI to fill in the test bodies.</strong> Never let AI define what “correct” means for your analysis.</li>
<li><strong>Treat AI output as a junior PR.</strong> You’d review a junior colleague’s code carefully. Same standard applies.</li>
</ul>
</section>
<section id="dont" class="level3">
<h3 class="anchored" data-anchor-id="dont">Don’t</h3>
<ul>
<li><strong>Delegate statistical test or model selection.</strong> This requires domain knowledge the model does not have — experimental design, distributional assumptions, multiple testing context.</li>
<li><strong>Use cloud tools on patient data, proprietary formulations, or anything under a non-disclosure agreement (NDA).</strong> Even if the provider claims not to train on your data, your organization’s data governance policy likely has an opinion.</li>
<li><strong>Accept code you don’t understand.</strong> If you can’t explain what a generated block does, you cannot debug it when it breaks in production.</li>
<li><strong>Rely on AI for package version advice.</strong> Training cutoffs mean models routinely suggest deprecated APIs. Always check the current documentation.</li>
<li><strong>Use AI to draft regulatory documents without expert review.</strong> International Council for Harmonisation (ICH) E9, ISO 14971, 21 CFR Part 11 — these are not contexts for generated text without thorough human authorship and review.</li>
</ul>
<hr>
</section>
</section>
<section id="configs" class="level2">
<h2 class="anchored" data-anchor-id="configs">Configs</h2>
<section id="githubcopilot-instructions.md-r-python-data-science-project" class="level3">
<h3 class="anchored" data-anchor-id="githubcopilot-instructions.md-r-python-data-science-project"><code>.github/copilot-instructions.md</code> — R + Python data science project</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># Copilot Instructions</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Stack</span></span>
<span id="cb3-4">R (primary) + Python (ML pipeline). Quarto for reporting.</span>
<span id="cb3-5">Package management: renv (R), uv (Python).</span>
<span id="cb3-6">Formatters: air (R), ruff (Python).</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## R conventions</span></span>
<span id="cb3-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>tidyverse style: pipe operator |&gt;, tibbles, no base R data frames</span>
<span id="cb3-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Statistical modelling: lme4 for mixed models, survival for time-to-event</span>
<span id="cb3-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Reporting: quarto .qmd, not .Rmd</span>
<span id="cb3-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never suggest: setwd(), attach(), T/F instead of TRUE/FALSE</span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Python conventions  </span></span>
<span id="cb3-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Type hints on all function signatures</span>
<span id="cb3-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>dataclasses or pydantic for data structures</span>
<span id="cb3-17"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Never suggest: pip install — always uv add</span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Sensitive context</span></span>
<span id="cb3-20">This project may handle R&amp;D data. Do not suggest cloud storage solutions</span>
<span id="cb3-21">or external API calls without flagging the data governance implications.</span></code></pre></div></div>
</section>
<section id="minimal-agents.md-template" class="level3">
<h3 class="anchored" data-anchor-id="minimal-agents.md-template">Minimal <code>AGENTS.md</code> template</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># AGENTS.md</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Project</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">One-line description</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Stack</span></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Languages, frameworks, key libraries</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Conventions</span></span>
<span id="cb4-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Formatter and linter</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Package manager</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Git commit style</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-13"></span>
<span id="cb4-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Hard rules</span></span>
<span id="cb4-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Things that must never happen</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Files that must never be edited manually</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-17"></span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Domain context</span></span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">Anything the AI needs to know to avoid producing wrong-domain outputs</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="ollama-continue-config.json" class="level3">
<h3 class="anchored" data-anchor-id="ollama-continue-config.json">Ollama + Continue <code>config.json</code></h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-7" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-7-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"models"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-7-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-7-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeepSeek Coder V2"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"provider"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepseek-coder-v2"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiBase"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-8" class="code-annotation-target">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"contextLength"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16384</span></span>
<span id="annotated-cell-7-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-7-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-11" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tabAutocompleteModel"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-7-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Phi-4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"provider"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ollama"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-14">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiBase"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:11434"</span></span>
<span id="annotated-cell-7-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-17" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"slashCommands"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-7-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"edit"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edit highlighted code"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-7-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"explain"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Explain the selected code"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-7-20">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-7-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="1">Maximum context window in tokens — set to match the model’s actual capacity; larger values increase memory use.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="11" data-code-annotation="2">Separate model for inline tab-completion — use a lighter, faster model here to keep latency low while typing.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="17" data-code-annotation="3">Slash commands available in the Continue chat panel — <code>/edit</code> and <code>/explain</code> cover the most common interactive use cases.</span>
</dd>
</dl>
<hr>
</section>
</section>
<section id="the-deeper-question" class="level2">
<h2 class="anchored" data-anchor-id="the-deeper-question">The deeper question</h2>
<p>The most significant shift LLM tools have introduced is not writing speed — it’s the reading-to-writing ratio. A larger fraction of programming time is now spent reading and evaluating generated code rather than writing from scratch. This is not obviously an improvement. Writing forces you to think through the logic. Reading generated output creates a plausible-enough illusion of understanding that can be hard to distinguish from the real thing.</p>
<p>There is a cognitive load trap. When a model produces a correct-looking solution quickly, it is easy to accept it without the slower thinking that would catch a subtle statistical error or an off-by-one in a loop. The speed gain is real; the risk is that you externalize the thinking that was doing useful work.</p>
<p>The reproducibility paradox is related: you can reproduce the output (run the code again, get the same result), but you often cannot reproduce the reasoning. Why was this model chosen? Why this correction method? If the answer is “the AI suggested it,” that’s not a defensible answer in a regulated context, and it’s not a good answer in a scientific one either.</p>
<p>My honest read on where this leaves data scientists: the value of domain judgment has increased, not decreased. Anyone can now produce working boilerplate quickly. What differentiates good analytical work is the judgment about what question to ask, what method is appropriate, and what the result actually means — none of which AI tools handle well. Junior data scientists may find AI tools make them look more productive while slowing their development of that judgment. Senior practitioners benefit most, because they have the domain knowledge to catch the errors and direct the tools effectively.</p>
<p>Use the tools. Read everything they produce. Keep the judgment to yourself.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>AI Tools</category>
  <category>GitHub Copilot</category>
  <category>LLM</category>
  <category>Development</category>
  <category>VS Code</category>
  <category>Ollama</category>
  <category>Workflow</category>
  <guid>https://antoinelucasfra.github.io/posts/llm-coding-assistant/</guid>
  <pubDate>Mon, 13 Oct 2025 22:00:00 GMT</pubDate>
</item>
<item>
  <title>The Reproducibility Quest: Modern Tools for R and Python Data Science</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/reproducibility-modern-tools/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Reproducibility is <span class="highlight" data-bg-colour="gold" data-colour="navy">the cornerstone of credible data science</span>. Whether you’re in academia, pharma, finance, or tech, the ability to recreate your analysis environment and results is essential. Yet achieving true reproducibility has historically been painful — a maze of version conflicts, missing dependencies, and the dreaded “works on my machine” syndrome.</p>
<p>The good news? We’re living in a golden age of reproducibility tooling. Both R and Python ecosystems have evolved dramatically, offering modern solutions that make reproducible workflows not just possible, but practical. This post covers the complete picture: from setting up a solid development environment in the first place, through package management and containerization, to what reproducibility actually requires when you’re working under regulatory constraints.</p>
<p>But before diving into tools, let’s address a crucial question: <strong>how much reproducibility do you actually need?</strong></p>
<hr>
</section>
<section id="setting-up-your-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-your-environment">Setting Up Your Environment</h2>
<p>Before you can have a reproducible workflow, you need a consistent development environment. This matters more than most people realise — subtle differences between machines (R versions, system libraries, editor settings) cause problems that are hard to debug and impossible to prevent without a baseline setup.</p>
<section id="vs-code-as-your-polyglot-ide" class="level3">
<h3 class="anchored" data-anchor-id="vs-code-as-your-polyglot-ide">VS Code as your polyglot IDE</h3>
<p>If you write both R and Python, VS Code is the only reasonable choice. RStudio is excellent for pure R work but does not handle Python well. PyCharm goes the other way. VS Code handles both, plus Quarto, plus Bash, plus whatever else you need.</p>
<p>The extensions that actually matter for a data science setup:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Extension</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>REditorSupport.r</code></td>
<td>R language support, inline output, completion</td>
</tr>
<tr class="even">
<td><code>Posit.air-vscode</code></td>
<td>R formatter (air) — format-on-save</td>
</tr>
<tr class="odd">
<td><code>ms-python.python</code></td>
<td>Python language support</td>
</tr>
<tr class="even">
<td><code>charliermarsh.ruff</code></td>
<td>Python formatter + linter (ruff) — format-on-save</td>
</tr>
<tr class="odd">
<td><code>quarto.quarto</code></td>
<td>Quarto rendering, preview, syntax</td>
</tr>
<tr class="even">
<td><code>mcanouil.quarto-wizard</code></td>
<td>Extension manager for Quarto</td>
</tr>
<tr class="odd">
<td><code>ms-toolsai.jupyter</code></td>
<td>Jupyter kernel support</td>
</tr>
<tr class="even">
<td><code>marimo-team.vscode-marimo</code></td>
<td>marimo reactive notebook support</td>
</tr>
<tr class="odd">
<td><code>usernamehw.errorlens</code></td>
<td>Inline linting errors (R and Python)</td>
</tr>
</tbody>
</table>
<p>A minimal <code>settings.json</code> that wires everything together:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-1-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"[r]"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-3" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.defaultFormatter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posit.air-vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-4" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.formatOnSave"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="annotated-cell-1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-1-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"[python]"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-7" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.defaultFormatter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliermarsh.ruff"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-1-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.formatOnSave"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="annotated-cell-1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-10" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"r.useRenvLibPath"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5">5</button><span id="annotated-cell-1-11" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"r.rterm.option"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--no-save"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--no-restore-data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--quiet"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6">6</button><span id="annotated-cell-1-12" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"python.defaultInterpreterPath"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"${workspaceFolder}/.venv/bin/python"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="7">7</button><span id="annotated-cell-1-13" class="code-annotation-target">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"editor.rulers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">88</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="1">Use <code>air</code> (Posit’s Rust-based formatter) as the default R formatter — replaces <code>styler</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4,8" data-code-annotation="2">Auto-format on every save — no manual <code>air format .</code> needed during editing.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="7" data-code-annotation="3">Use <code>ruff</code> as formatter for Python — one tool replaces <code>black</code>, <code>isort</code>, and <code>flake8</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="10" data-code-annotation="4">Tell the R extension to use the <code>renv</code> project library instead of the system library.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="11" data-code-annotation="5">Start R sessions without loading <code>.RData</code> — prevents stale objects from contaminating fresh runs.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="12" data-code-annotation="6">Point Python to the project-local <code>.venv</code> — ensures <code>uv</code>-managed packages are picked up.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="13" data-code-annotation="7">Draw a vertical ruler at column 88 — the default line-length limit used by <code>ruff</code>.</span>
</dd>
</dl>
</section>
<section id="r-install-via-rig-not-cran" class="level3">
<h3 class="anchored" data-anchor-id="r-install-via-rig-not-cran">R: install via rig, not CRAN</h3>
<p><a href="https://github.com/r-lib/rig">rig</a> is the R Installation Manager. Install it once, then install and switch between R versions cleanly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># macOS</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-2" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap r-lib/rig <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install rig</span>
<span id="annotated-cell-2-3"></span>
<span id="annotated-cell-2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Linux</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2">2</button><span id="annotated-cell-2-5" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://rig.r-lib.org/rig-linux-latest.tar.gz <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> tar xz <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-C</span> /usr/local</span>
<span id="annotated-cell-2-6"></span>
<span id="annotated-cell-2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install a specific R version</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3">3</button><span id="annotated-cell-2-8" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add 4.5</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4">4</button><span id="annotated-cell-2-9" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> default 4.5</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="1">Install <code>rig</code> via Homebrew on macOS — the one-time setup step.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="2">Linux alternative: download and extract the binary to <code>/usr/local</code> with <code>sudo</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="8" data-code-annotation="3">Install R 4.5 — <code>rig add</code> downloads and sets up that exact version without touching other installations.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="9" data-code-annotation="4">Set R 4.5 as the default version system-wide.</span>
</dd>
</dl>
<p>Never install R by downloading from CRAN. <code>rig</code> makes version switching trivial and doesn’t pollute your system.</p>
</section>
<section id="python-install-via-uv-not-the-system-python" class="level3">
<h3 class="anchored" data-anchor-id="python-install-via-uv-not-the-system-python">Python: install via uv, not the system Python</h3>
<p><a href="https://docs.astral.sh/uv/">uv</a> manages Python versions and virtual environments. The system Python should never be touched for project work:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install uv</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-2" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LsSf</span> https://astral.sh/uv/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span></span>
<span id="annotated-cell-3-3"></span>
<span id="annotated-cell-3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install and pin a Python version for a project</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-5" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python install 3.12</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-6" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python pin 3.12</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1">One-liner installer — writes a <code>uv</code> binary to <code>~/.cargo/bin</code> (or <code>~/.local/bin</code>). No admin rights needed.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5" data-code-annotation="2">Download and install CPython 3.12 — managed entirely by <code>uv</code>, isolated from the system Python.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="6" data-code-annotation="3">Write a <code>.python-version</code> file pinning this project to 3.12 — respected by <code>uv run</code> and <code>uv sync</code>.</span>
</dd>
</dl>
</section>
<section id="formatting-and-linting" class="level3">
<h3 class="anchored" data-anchor-id="formatting-and-linting">Formatting and linting</h3>
<ul>
<li><strong>R:</strong> <code>air</code> — a Rust-based formatter from Posit. Fast, opinionated, and it replaces <code>styler</code>. Never use <code>formatR</code>. Configure via <code>air.toml</code> at project root.</li>
<li><strong>Python:</strong> <code>ruff</code> — formatter and linter in one. Replaces <code>black</code>, <code>isort</code>, <code>flake8</code>. Configure via <code>pyproject.toml</code>.</li>
</ul>
<p>Both integrate with VS Code for format-on-save. This matters for reproducibility in a non-obvious way: consistent formatting means diffs are about logic, not whitespace, which makes code review and change tracking actually useful.</p>
</section>
<section id="notebooks-marimo-over-jupyter" class="level3">
<h3 class="anchored" data-anchor-id="notebooks-marimo-over-jupyter">Notebooks: marimo over Jupyter</h3>
<p>If you write Python notebooks, <a href="https://marimo.io/">marimo</a> is worth evaluating. It’s reactive (cells re-execute when their dependencies change), stores notebooks as pure Python scripts (Git-friendly, no JSON blob), and has a better story for reproducibility than classical Jupyter. For R, Quarto documents are the right answer for anything that isn’t pure exploration.</p>
<hr>
</section>
</section>
<section id="the-reproducibility-spectrum-scoping-your-needs" class="level2">
<h2 class="anchored" data-anchor-id="the-reproducibility-spectrum-scoping-your-needs">The Reproducibility Spectrum: Scoping Your Needs</h2>
<p>Not every project requires the same level of reproducibility investment. A quick exploratory analysis for an internal meeting doesn’t need the same rigor as a clinical trial submission to the U.S. Food and Drug Administration (FDA). Understanding where your project falls on this spectrum is essential for efficient resource allocation.</p>
<section id="levels-of-reproducibility" class="level3">
<h3 class="anchored" data-anchor-id="levels-of-reproducibility">Levels of Reproducibility</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 25%">
<col style="width: 37%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Level</th>
<th>Description</th>
<th>Typical Use Cases</th>
<th>Investment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>L1: Minimal</strong></td>
<td>Code runs on author’s machine</td>
<td>Personal exploration, quick prototypes</td>
<td>Low</td>
</tr>
<tr class="even">
<td><strong>L2: Documented</strong></td>
<td>README with manual setup instructions</td>
<td>Team projects, handoffs</td>
<td>Low-Medium</td>
</tr>
<tr class="odd">
<td><strong>L3: Lockfile</strong></td>
<td>Pinned package versions</td>
<td>Production analyses, shared projects</td>
<td>Medium</td>
</tr>
<tr class="even">
<td><strong>L4: Containerized</strong></td>
<td>Full environment specification</td>
<td>Regulated industries, long-term archives</td>
<td>Medium-High</td>
</tr>
<tr class="odd">
<td><strong>L5: Fully Isolated</strong></td>
<td>Container + data versioning + workflow</td>
<td>Clinical trials, financial audits</td>
<td>High</td>
</tr>
</tbody>
</table>
</section>
<section id="scoping-questions" class="level3">
<h3 class="anchored" data-anchor-id="scoping-questions">Scoping Questions</h3>
<p>Before setting up your reproducibility stack, ask:</p>
<ol type="1">
<li><strong>Who needs to reproduce this?</strong>
<ul>
<li>Just me, in 6 months? → L2-L3</li>
<li>My team? → L3</li>
<li>External auditors? → L4-L5</li>
<li>The entire scientific community? → L5</li>
</ul></li>
<li><strong>What’s the regulatory context?</strong>
<ul>
<li>Internal exploration → L1-L2</li>
<li>Published research → L3-L4</li>
<li>Regulatory submission → L5</li>
</ul></li>
<li><strong>What’s the project lifespan?</strong>
<ul>
<li>One-off analysis → L1-L2</li>
<li>Quarterly reports → L3</li>
<li>Multi-year project → L4-L5</li>
</ul></li>
<li><strong>What’s the cost of failure?</strong>
<ul>
<li>Learning exercise → L1</li>
<li>Business decision → L3</li>
<li>Patient safety → L5</li>
</ul></li>
</ol>
</section>
<section id="the-reproducibility-tax" class="level3">
<h3 class="anchored" data-anchor-id="the-reproducibility-tax">The Reproducibility Tax</h3>
<p>Every level of reproducibility adds friction:</p>
<ul>
<li><strong>L1→L2</strong>: Writing documentation (minutes)</li>
<li><strong>L2→L3</strong>: Managing lockfiles, occasional dependency conflicts (hours)</li>
<li><strong>L3→L4</strong>: Container setup, debugging build issues (days initially)</li>
<li><strong>L4→L5</strong>: Data versioning, workflow management, continuous integration/continuous deployment (CI/CD) (ongoing effort)</li>
</ul>
<p>The goal is to pay the <em>right</em> amount of tax for your context — not more, not less.</p>
<hr>
</section>
</section>
<section id="the-convergence-r-and-python-are-aligning" class="level2">
<h2 class="anchored" data-anchor-id="the-convergence-r-and-python-are-aligning">The Convergence: R and Python Are Aligning</h2>
<p>Something remarkable is happening: the R and Python ecosystems are converging on similar reproducibility paradigms. This isn’t coincidental — it reflects hard-won lessons about what works.</p>
<section id="shared-principles" class="level3">
<h3 class="anchored" data-anchor-id="shared-principles">Shared Principles</h3>
<p>Both communities have arrived at the same conclusions:</p>
<ol type="1">
<li><strong>Declarative over imperative</strong> — Define desired state, not installation steps</li>
<li><strong>Lockfiles are essential</strong> — Capture exact versions at installation time</li>
<li><strong>TOML for configuration</strong> — Human-readable, standardized format</li>
<li><strong>Rust for tooling</strong> — Performance matters for developer experience</li>
<li><strong>Holistic resolution</strong> — Solve the entire dependency tree before installing</li>
</ol>
</section>
<section id="the-modern-stack-comparison" class="level3">
<h3 class="anchored" data-anchor-id="the-modern-stack-comparison">The Modern Stack Comparison</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 24%">
<col style="width: 9%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Concept</th>
<th>Python</th>
<th>R</th>
<th>Convergence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Package manager</td>
<td>uv</td>
<td>rv</td>
<td>Both Rust, declarative, TOML-based</td>
</tr>
<tr class="even">
<td>Config file</td>
<td><code>pyproject.toml</code></td>
<td><code>rproject.toml</code></td>
<td>Same format, similar structure</td>
</tr>
<tr class="odd">
<td>Lockfile</td>
<td><code>uv.lock</code></td>
<td><code>rv.lock</code></td>
<td>Same purpose, similar approach</td>
</tr>
<tr class="even">
<td>Version manager</td>
<td>uv, pyenv</td>
<td>rig</td>
<td>CLI-based, multiple versions</td>
</tr>
<tr class="odd">
<td>Formatter</td>
<td>ruff</td>
<td>air</td>
<td>Fast, opinionated, Rust-based</td>
</tr>
<tr class="even">
<td>Containers</td>
<td>devcontainers</td>
<td>devcontainers + Rocker</td>
<td>Same specification</td>
</tr>
</tbody>
</table>
<p>This convergence means skills transfer between languages, and polyglot projects become easier to manage.</p>
<hr>
</section>
</section>
<section id="package-management-the-foundation" class="level2">
<h2 class="anchored" data-anchor-id="package-management-the-foundation">Package Management: The Foundation</h2>
<section id="python-the-uv-revolution" class="level3">
<h3 class="anchored" data-anchor-id="python-the-uv-revolution">Python: The uv Revolution</h3>
<p><a href="https://docs.astral.sh/uv/">uv</a> has fundamentally changed Python package management. Written in Rust, it’s blazingly fast and consolidates what used to require multiple tools (pyenv, pip, virtualenv, pip-tools) into one coherent experience.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install uv</span></span>
<span id="annotated-cell-4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LsSf</span> https://astral.sh/uv/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span></span>
<span id="annotated-cell-4-3"></span>
<span id="annotated-cell-4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a new project</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-5" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> init my-analysis</span>
<span id="annotated-cell-4-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> my-analysis</span>
<span id="annotated-cell-4-7"></span>
<span id="annotated-cell-4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add dependencies</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-9" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> add pandas numpy scikit-learn matplotlib</span>
<span id="annotated-cell-4-10"></span>
<span id="annotated-cell-4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sync environment</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-12" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> sync</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="5" data-code-annotation="1">Scaffold a new project: creates <code>pyproject.toml</code>, <code>README.md</code>, and a <code>hello.py</code> stub.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="9" data-code-annotation="2">Add packages to <code>pyproject.toml</code> and install them into the project’s <code>.venv</code> in one step.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="12" data-code-annotation="3">Recreate <code>.venv</code> from the lockfile — ensures every collaborator gets bit-for-bit identical packages.</span>
</dd>
</dl>
<p>The <code>pyproject.toml</code> becomes your single source of truth:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-5" style="background: #f1f3f5;"><pre class="sourceCode toml code-annotation-code code-with-copy code-annotated"><code class="sourceCode toml"><span id="annotated-cell-5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="annotated-cell-5-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-analysis"</span></span>
<span id="annotated-cell-5-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-4" class="code-annotation-target"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=3.11"</span></span>
<span id="annotated-cell-5-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-5-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pandas&gt;=2.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numpy&gt;=1.24"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scikit-learn&gt;=1.3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matplotlib&gt;=3.7"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-5-11"></span>
<span id="annotated-cell-5-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.uv]</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-13" class="code-annotation-target"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dev-dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-5-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pytest&gt;=7.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ruff&gt;=0.1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-5-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="4" data-code-annotation="1">Minimum Python version constraint — <code>uv</code> enforces this and will refuse to create an incompatible environment.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="13" data-code-annotation="2">Dev-only dependencies not installed in production or CI — keeps the deployment environment lean.</span>
</dd>
</dl>
<p>Key features that make <code>uv</code> essential:</p>
<ul>
<li><strong>Lockfile (<code>uv.lock</code>)</strong> — Captures exact versions for reproducibility</li>
<li><strong>Python version management</strong> — No need for separate pyenv</li>
<li><strong>Blazing fast</strong> — 10-100x faster than pip</li>
<li><strong>Declarative</strong> — Describe what you want, not how to get there</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uv can manage Python versions too</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python install 3.12</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python pin 3.11</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run scripts with automatic environment setup</span></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> run python analysis.py</span></code></pre></div></div>
</section>
<section id="r-the-rv-revolution" class="level3">
<h3 class="anchored" data-anchor-id="r-the-rv-revolution">R: The rv Revolution</h3>
<p>On the R side, <a href="https://a2-ai.github.io/rv-docs/">rv</a> brings the same declarative philosophy. If you’ve been using <code>renv</code>, <code>rv</code> will feel like a significant upgrade.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-7" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rv</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-2" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sSL</span> https://raw.githubusercontent.com/A2-ai/rv/refs/heads/main/scripts/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="annotated-cell-7-3"></span>
<span id="annotated-cell-7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a new project</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-5" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> init my-analysis</span>
<span id="annotated-cell-7-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> my-analysis</span>
<span id="annotated-cell-7-7"></span>
<span id="annotated-cell-7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add dependencies</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-9" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> add tidyverse arrow DBI</span>
<span id="annotated-cell-7-10"></span>
<span id="annotated-cell-7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sync</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4">4</button><span id="annotated-cell-7-12" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="1">One-liner install — downloads the <code>rv</code> binary and places it on your <code>PATH</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="5" data-code-annotation="2">Initialise the project: creates <code>rproject.toml</code> with the current R version pre-filled.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9" data-code-annotation="3">Add packages to <code>rproject.toml</code> — <code>rv</code> resolves and installs them immediately.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="12" data-code-annotation="4">Install all declared packages into the project library — the equivalent of <code>renv::restore()</code> but driven by a declarative manifest.</span>
</dd>
</dl>
<p>Your <code>rproject.toml</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-8" style="background: #f1f3f5;"><pre class="sourceCode toml code-annotation-code code-with-copy code-annotated"><code class="sourceCode toml"><span id="annotated-cell-8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="annotated-cell-8-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-analysis"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-3" class="code-annotation-target"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">r_version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.5"</span></span>
<span id="annotated-cell-8-4"></span>
<span id="annotated-cell-8-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repositories</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2">2</button><span id="annotated-cell-8-6" class="code-annotation-target">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PPM"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://packagemanager.posit.co/cran/latest"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="annotated-cell-8-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-8-8"></span>
<span id="annotated-cell-8-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-8-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-8-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arrow"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-8-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DBI"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-8-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="3" data-code-annotation="1">Pins the exact R version — <code>rv</code> will warn if you try to sync on a different version.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6" data-code-annotation="2">Use Posit Package Manager (PPM) instead of CRAN — provides pre-built binaries, dramatically faster installs on Linux.</span>
</dd>
</dl>
</section>
<section id="renv-the-established-alternative" class="level3">
<h3 class="anchored" data-anchor-id="renv-the-established-alternative">renv: The Established Alternative</h3>
<p>While <code>rv</code> is the future, <a href="https://rstudio.github.io/renv/">renv</a> remains the most widely adopted solution:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize renv</span></span>
<span id="cb2-2">renv<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">init</span>()</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install packages as usual</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Snapshot your dependencies</span></span>
<span id="cb2-8">renv<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">snapshot</span>()</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Restore on another machine</span></span>
<span id="cb2-11">renv<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">restore</span>()</span></code></pre></div></div>
<p>The key difference: <code>renv</code> is reactive (snapshot after installation), while <code>rv</code> is declarative (define desired state, then sync).</p>
</section>
<section id="when-to-use-what" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-what">When to Use What</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 47%">
<col style="width: 38%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th>Python</th>
<th>R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>New projects</td>
<td>uv</td>
<td>rv</td>
</tr>
<tr class="even">
<td>Legacy projects</td>
<td>pip + requirements.txt</td>
<td>renv</td>
</tr>
<tr class="odd">
<td>Corporate environments</td>
<td>uv (or pip if restricted)</td>
<td>renv (more established)</td>
</tr>
<tr class="even">
<td>Bleeding edge</td>
<td>uv</td>
<td>rv</td>
</tr>
<tr class="odd">
<td>Maximum compatibility</td>
<td>pip</td>
<td>renv</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="language-version-management" class="level2">
<h2 class="anchored" data-anchor-id="language-version-management">Language Version Management</h2>
<section id="r-rig" class="level3">
<h3 class="anchored" data-anchor-id="r-rig">R: rig</h3>
<p><a href="https://github.com/r-lib/rig">rig</a> is the R Installation Manager — think of it as pyenv for R:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rig (macOS)</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap r-lib/rig <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install rig</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rig (Linux)</span></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://rig.r-lib.org/rig-linux-latest.tar.gz <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> tar xz <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-C</span> /usr/local</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List available versions</span></span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> available</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install specific version</span></span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add 4.5</span>
<span id="cb3-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add 4.4</span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Switch between versions</span></span>
<span id="cb3-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> default 4.5</span>
<span id="cb3-16"></span>
<span id="cb3-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List installed versions</span></span>
<span id="cb3-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> list</span></code></pre></div></div>
</section>
<section id="python-uv-or-pyenv" class="level3">
<h3 class="anchored" data-anchor-id="python-uv-or-pyenv">Python: uv or pyenv</h3>
<p><code>uv</code> now handles Python version management directly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install Python 3.12</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python install 3.12</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pin project to specific version</span></span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python pin 3.11</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List installed versions</span></span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> python list</span></code></pre></div></div>
<p>Alternatively, <a href="https://github.com/pyenv/pyenv">pyenv</a> remains a solid choice:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install pyenv</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> https://pyenv.run <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install Python version</span></span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pyenv</span> install 3.11.6</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set local version for project</span></span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pyenv</span> local 3.11.6</span></code></pre></div></div>
<hr>
</section>
</section>
<section id="environment-control-devcontainers" class="level2">
<h2 class="anchored" data-anchor-id="environment-control-devcontainers">Environment Control: DevContainers</h2>
<p>Package managers handle libraries, but what about system dependencies? OpenSSL, GDAL, database drivers, C compilers… these often cause the most painful reproducibility issues.</p>
<section id="what-are-devcontainers" class="level3">
<h3 class="anchored" data-anchor-id="what-are-devcontainers">What Are DevContainers?</h3>
<p><a href="https://containers.dev/">Development Containers</a> provide a complete, containerized development environment. They’re Docker containers configured specifically for development, with full integrated development environment (IDE) integration.</p>
<p>A <code>.devcontainer/devcontainer.json</code> defines your environment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-13" style="background: #f1f3f5;"><pre class="sourceCode json code-annotation-code code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-13-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R &amp; Python Data Science"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-3" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"image"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer/tidyverse:4.4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-13-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"features"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2">2</button><span id="annotated-cell-13-5" class="code-annotation-target">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer-features/quarto-cli:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="annotated-cell-13-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/devcontainers/features/python:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3">3</button><span id="annotated-cell-13-7" class="code-annotation-target">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.11"</span></span>
<span id="annotated-cell-13-8">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-13-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="annotated-cell-13-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customizations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-13-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-13-12">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="annotated-cell-13-13">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REditorSupport.r"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-13-14">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-python.python"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-13-15">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto.quarto"</span></span>
<span id="annotated-cell-13-16">            <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-13-17">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"settings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="annotated-cell-13-18">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"r.rterm.linux"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/local/bin/R"</span></span>
<span id="annotated-cell-13-19">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-13-20">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="annotated-cell-13-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4">4</button><span id="annotated-cell-13-22" class="code-annotation-target">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"postCreateCommand"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uv sync &amp;&amp; rv sync"</span></span>
<span id="annotated-cell-13-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="3" data-code-annotation="1">Base image from the Rocker Project — a battle-tested R 4.4 environment with the tidyverse and system libraries pre-installed.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="5" data-code-annotation="2">Add Quarto CLI as a devcontainer feature — installs on top of the base image without modifying the Dockerfile.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="7" data-code-annotation="3">Add Python 3.11 as a feature — layered cleanly alongside R in the same container.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="22" data-code-annotation="4">Run after the container is created: restore the Python virtual environment and the R package library from their respective lockfiles.</span>
</dd>
</dl>
</section>
<section id="when-to-use-devcontainers" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-devcontainers">When to Use DevContainers</h3>
<p>DevContainers are <strong>L4 reproducibility</strong> — use them when:</p>
<ul>
<li>System dependencies are complex (geospatial, databases, specific compilers)</li>
<li>Team onboarding needs to be instant</li>
<li>You need CI/CD parity with development</li>
<li>Long-term archival is required</li>
</ul>
<p>Skip them when:</p>
<ul>
<li>Pure R/Python with no system dependencies</li>
<li>Quick personal projects</li>
<li>Environments where Docker isn’t available</li>
</ul>
</section>
<section id="r-specific-devcontainers-with-rocker" class="level3">
<h3 class="anchored" data-anchor-id="r-specific-devcontainers-with-rocker">R-Specific DevContainers with Rocker</h3>
<p>The <a href="https://rocker-project.org/">Rocker Project</a> provides excellent base images:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R Development"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"image"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer/tidyverse:4.4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"features"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer-features/quarto-cli:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb6-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer-features/rig:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb6-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>Available images:</p>
<ul>
<li><code>rocker/r-ver</code> — Base R</li>
<li><code>rocker/tidyverse</code> — R + tidyverse packages</li>
<li><code>rocker/verse</code> — tidyverse + LaTeX</li>
<li><code>rocker/geospatial</code> — Includes GDAL (Geospatial Data Abstraction Library), GEOS (Geometry Engine — Open Source), PROJ (cartographic projections library)</li>
</ul>
</section>
<section id="multi-language-devcontainer" class="level3">
<h3 class="anchored" data-anchor-id="multi-language-devcontainer">Multi-Language DevContainer</h3>
<p>For projects using both R and Python:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R + Python Data Science"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"build"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-4">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dockerfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dockerfile"</span></span>
<span id="cb7-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb7-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"features"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/rocker-org/devcontainer-features/quarto-cli:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb7-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb7-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"postCreateCommand"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rv sync &amp;&amp; uv sync"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customizations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-12">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb7-13">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REditorSupport.r"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-14">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-python.python"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-15">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto.quarto"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posit.publisher"</span></span>
<span id="cb7-17">            <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb7-18">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>With a custom Dockerfile:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> ghcr.io/rocker-org/devcontainer/tidyverse:4.4</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install uv for Python</span></span>
<span id="cb8-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LsSf</span> https://astral.sh/uv/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span></span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rv for R</span></span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sSL</span> https://raw.githubusercontent.com/A2-ai/rv/refs/heads/main/scripts/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># System dependencies</span></span>
<span id="cb8-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt-get</span> update <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt-get</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-y</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb8-11">    libpq-dev <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb8-12">    libgdal-dev <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb8-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rf</span> /var/lib/apt/lists/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span></code></pre></div></div>
<hr>
</section>
</section>
<section id="workflow-orchestration" class="level2">
<h2 class="anchored" data-anchor-id="workflow-orchestration">Workflow Orchestration</h2>
<p>Beyond package management, you need tools to manage the execution flow of your analysis. <a href="https://snakemake.github.io/">Snakemake</a> is the most widely adopted cross-language option.</p>
<section id="snakemake" class="level3">
<h3 class="anchored" data-anchor-id="snakemake">Snakemake</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Snakefile</span></span>
<span id="cb9-2">rule <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>:</span>
<span id="cb9-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results/final_report.html"</span></span>
<span id="cb9-4"></span>
<span id="cb9-5">rule clean_data:</span>
<span id="cb9-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/raw.csv"</span></span>
<span id="cb9-7">    output: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/clean.csv"</span></span>
<span id="cb9-8">    script: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scripts/clean.py"</span></span>
<span id="cb9-9"></span>
<span id="cb9-10">rule train_model:</span>
<span id="cb9-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/clean.csv"</span></span>
<span id="cb9-12">    output: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"models/model.pkl"</span></span>
<span id="cb9-13">    script: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scripts/train.py"</span></span></code></pre></div></div>
<hr>
</section>
</section>
<section id="documentation-quarto" class="level2">
<h2 class="anchored" data-anchor-id="documentation-quarto">Documentation: Quarto</h2>
<p><a href="https://quarto.org/">Quarto</a> unifies documentation across R, Python, and Julia. A typical Quarto document combines markdown narrative with code chunks in either language.</p>
<p>Key reproducibility feature: With <code>freeze: auto</code> in your YAML header, Quarto caches computational outputs, so documents can be re-rendered without re-executing all code — improving both reproducibility and build times.</p>
<p>Quarto documents use fenced code blocks with language specifiers like <code>{python}</code> or <code>{r}</code> to indicate executable code, and can output to HTML, PDF, Word, and many other formats.</p>
<hr>
</section>
<section id="organizational-considerations" class="level2">
<h2 class="anchored" data-anchor-id="organizational-considerations">Organizational Considerations</h2>
<section id="team-standards" class="level3">
<h3 class="anchored" data-anchor-id="team-standards">Team Standards</h3>
<p>Different teams within an organization may need different reproducibility levels:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Team</th>
<th>Typical Level</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data Science R&amp;D</td>
<td>L2-L3</td>
<td>Fast iteration, exploration</td>
</tr>
<tr class="even">
<td>Production Analytics</td>
<td>L3-L4</td>
<td>Reliability, handoffs</td>
</tr>
<tr class="odd">
<td>Regulatory/Compliance</td>
<td>L4-L5</td>
<td>Audit requirements</td>
</tr>
<tr class="even">
<td>External Publications</td>
<td>L4-L5</td>
<td>Peer review, credibility</td>
</tr>
</tbody>
</table>
</section>
<section id="building-a-reproducibility-culture" class="level3">
<h3 class="anchored" data-anchor-id="building-a-reproducibility-culture">Building a Reproducibility Culture</h3>
<ol type="1">
<li><strong>Start with templates</strong> — Provide project templates at appropriate levels</li>
<li><strong>Automate checks</strong> — CI/CD that validates reproducibility</li>
<li><strong>Document decisions</strong> — Record <em>why</em> a certain level was chosen</li>
<li><strong>Review periodically</strong> — Projects may need to level up over time</li>
</ol>
</section>
<section id="the-cost-benefit-reality" class="level3">
<h3 class="anchored" data-anchor-id="the-cost-benefit-reality">The Cost-Benefit Reality</h3>
<p>The key insight: <span class="highlight" data-bg-colour="navy-mid" data-colour="snow">match your investment to your actual needs</span>. Over-engineering reproducibility for a throwaway analysis wastes time. Under-engineering for a regulatory submission creates risk.</p>
<p>As project risk and longevity increase, so should your reproducibility investment — from L1 (personal exploration) through L5 (regulatory/clinical).</p>
<hr>
</section>
</section>
<section id="regulated-environments-reproducibility-in-pharma-and-good-practices-gxp" class="level2">
<h2 class="anchored" data-anchor-id="regulated-environments-reproducibility-in-pharma-and-good-practices-gxp">Regulated Environments: Reproducibility in Pharma and Good Practices (GxP)</h2>
<p>Everything above applies to all data science work. But if you operate in a regulated environment — pharma, medical devices, clinical research — there are additional requirements that change the calculus significantly.</p>
<section id="what-fda-and-ema-actually-expect" class="level3">
<h3 class="anchored" data-anchor-id="what-fda-and-ema-actually-expect">What FDA and EMA actually expect</h3>
<p>The FDA’s 21 CFR Part 11 and the European Medicines Agency (EMA)’s comparable guidance don’t prescribe specific tools. What they require is an audit trail: given a result in a regulatory submission, you must be able to demonstrate exactly which code, which data, and which environment produced it — and reproduce it on demand.</p>
<p>In practice, this means:</p>
<ul>
<li><strong>Every analysis is traceable to a specific software version.</strong> Not “R 4.x”, but “R 4.4.2 with renv lockfile pinned to commit <code>abc123</code>”.</li>
<li><strong>Changes are documented.</strong> A git history is not optional; it’s part of the validation evidence.</li>
<li><strong>The environment is validated.</strong> IQ (Installation Qualification), OQ (Operational Qualification), PQ (Performance Qualification) aren’t bureaucratic theatre — they’re the documented proof that your platform behaves as expected.</li>
</ul>
</section>
<section id="sessioninfo-is-necessary-but-not-sufficient" class="level3">
<h3 class="anchored" data-anchor-id="sessioninfo-is-necessary-but-not-sufficient">sessionInfo() is necessary but not sufficient</h3>
<p><code>sessionInfo()</code> is the minimum. It tells you what packages were loaded in the R session at the time of analysis. Include it at the end of every regulatory-grade report:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sessionInfo</span>()</span></code></pre></div></div>
<p>But <code>sessionInfo()</code> alone doesn’t let you reproduce the environment. It describes it. To actually restore it, you need a lockfile.</p>
</section>
<section id="renv-docker-as-a-practical-iqoqpq-story" class="level3">
<h3 class="anchored" data-anchor-id="renv-docker-as-a-practical-iqoqpq-story">renv + Docker as a practical IQ/OQ/PQ story</h3>
<p>The validation stack for a Shiny platform running on Posit Connect looks like this when done right:</p>
<ol type="1">
<li><strong>renv</strong> — lockfile in the repository, pinned to an exact snapshot date. <code>renv::restore()</code> gives any auditor the exact library used in production.</li>
<li><strong>Docker</strong> — the base image is pinned (<code>rocker/r-ver:4.4.2</code>, not <code>rocker/r-ver:latest</code>). This ensures system libraries are frozen, not just R packages.</li>
<li><strong>GitHub Actions</strong> — CI runs the test suite and renders key reports on every push. The green CI badge is part of the OQ evidence.</li>
<li><strong>Posit Connect</strong> — deployment is version-controlled. Each deployed bundle has a manifest and can be rolled back.</li>
</ol>
<p>The IQ document answers: <em>“Is the software correctly installed?”</em> — covered by the Docker image build log and the <code>renv::restore()</code> log.</p>
<p>The OQ document answers: <em>“Does it perform as specified?”</em> — covered by the automated test suite.</p>
<p>The PQ document answers: <em>“Does it perform as required in production?”</em> — covered by UAT sign-off and monitoring dashboards.</p>
<p>This isn’t a heavy process once it’s set up. The overhead is in the documentation, not the tooling. The tooling is Git, renv, Docker, and a CI runner — none of which require purchasing a validated platform.</p>
</section>
<section id="the-practical-minimum-for-regulatory-r-work" class="level3">
<h3 class="anchored" data-anchor-id="the-practical-minimum-for-regulatory-r-work">The practical minimum for regulatory R work</h3>
<p>If you’re not running a full validated platform but still need to produce defensible analyses (clinical biostatistics reports, ingredient safety dossiers, etc.):</p>
<ol type="1">
<li><strong>Git</strong> — every script in version control, analysis tied to a commit hash</li>
<li><strong>renv</strong> — lockfile committed alongside the code</li>
<li><strong><code>sessionInfo()</code> in every report</strong> — as a footer, not optional</li>
<li><strong>Quarto with <code>freeze: auto</code></strong> — computational outputs frozen and committed; the rendered report is reproducible without re-executing</li>
</ol>
<p>This gets you to L3/L4 on the reproducibility spectrum at low overhead. It won’t satisfy IQ/OQ/PQ for a validated system, but it satisfies the traceability requirement for analytical work and will hold up to a reasonably thorough audit.</p>
<hr>
</section>
</section>
<section id="the-complete-reproducibility-checklist" class="level2">
<h2 class="anchored" data-anchor-id="the-complete-reproducibility-checklist">The Complete Reproducibility Checklist</h2>
<section id="project-structure" class="level3">
<h3 class="anchored" data-anchor-id="project-structure">Project Structure</h3>
<pre><code>my-project/
├── .devcontainer/
│   └── devcontainer.json     # Container environment (L4+)
├── .github/
│   └── workflows/
│       └── ci.yml            # Automated testing
├── data/
│   ├── raw/                  # Immutable raw data
│   └── processed/            # Generated data (gitignored)
├── src/                      # Source code
├── notebooks/                # Exploratory work
├── reports/                  # Quarto documents
├── tests/                    # Unit tests
├── pyproject.toml            # Python dependencies
├── uv.lock                   # Python lockfile
├── rproject.toml             # R dependencies
├── rv.lock                   # R lockfile
├── .gitignore
└── README.md</code></pre>
</section>
<section id="by-level" class="level3">
<h3 class="anchored" data-anchor-id="by-level">By Level</h3>
<p><strong>L1 (Minimal):</strong></p>
<ul>
<li>Code in version control</li>
</ul>
<p><strong>L2 (Documented):</strong></p>
<ul>
<li>README with setup instructions</li>
<li>List of required packages</li>
</ul>
<p><strong>L3 (Lockfile):</strong></p>
<ul>
<li><code>uv.lock</code> / <code>rv.lock</code> / <code>renv.lock</code></li>
<li>Language version specified</li>
<li>CI that runs tests</li>
</ul>
<p><strong>L4 (Containerized):</strong></p>
<ul>
<li>DevContainer configuration</li>
<li>System dependencies documented</li>
<li>CI uses same container</li>
</ul>
<p><strong>L5 (Fully Isolated):</strong></p>
<ul>
<li>Workflow management (Snakemake)</li>
<li>Complete audit trail</li>
<li>Archived container images</li>
</ul>
<hr>
</section>
</section>
<section id="summary-the-modern-reproducibility-toolkit" class="level2">
<h2 class="anchored" data-anchor-id="summary-the-modern-reproducibility-toolkit">Summary: The Modern Reproducibility Toolkit</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Need</th>
<th>Python</th>
<th>R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Package management</td>
<td>uv</td>
<td>rv, renv</td>
</tr>
<tr class="even">
<td>Version management</td>
<td>uv, pyenv</td>
<td>rig</td>
</tr>
<tr class="odd">
<td>Containerization</td>
<td>devcontainers</td>
<td>devcontainers + Rocker</td>
</tr>
<tr class="even">
<td>Workflow</td>
<td>Snakemake</td>
<td>Snakemake</td>
</tr>
<tr class="odd">
<td>Documentation</td>
<td>Quarto, Jupyter</td>
<td>Quarto</td>
</tr>
<tr class="even">
<td>Formatting</td>
<td>ruff</td>
<td>air</td>
</tr>
<tr class="odd">
<td>Linting</td>
<td>ruff</td>
<td>lintr</td>
</tr>
</tbody>
</table>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Reproducibility is no longer optional — it’s table stakes for professional data science. The tooling has matured to the point where reproducible workflows are not just possible but practical.</p>
<p>But remember: <strong>reproducibility is a spectrum, not a binary</strong>. The right approach depends on your context — who needs to reproduce the work, for how long, and at what stakes.</p>
<p>Start with package management (<code>uv</code> for Python, <code>rv</code> or <code>renv</code> for R), add language version control (<code>rig</code>, <code>uv python</code>), and when system dependencies become complex, embrace devcontainers. Layer in Snakemake for complex multi-step pipelines, and document everything with Quarto.</p>
<p>The investment in reproducibility pays dividends: faster onboarding, fewer “works on my machine” incidents, easier debugging, and the confidence that your results can be verified and trusted. Just make sure you’re investing the right amount for your actual needs.</p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://docs.astral.sh/uv/">uv Documentation</a></li>
<li><a href="https://a2-ai.github.io/rv-docs/">rv Documentation</a></li>
<li><a href="https://rstudio.github.io/renv/">renv Documentation</a></li>
<li><a href="https://github.com/r-lib/rig">rig - R Installation Manager</a></li>
<li><a href="https://containers.dev/">DevContainers Specification</a></li>
<li><a href="https://rocker-project.org/">Rocker Project</a></li>
<li><a href="https://quarto.org/">Quarto</a></li>
<li><a href="https://snakemake.github.io/">Snakemake</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>R</category>
  <category>Python</category>
  <category>Reproducibility</category>
  <category>DevContainers</category>
  <category>Docker</category>
  <category>Package Management</category>
  <category>Best Practices</category>
  <category>VS Code</category>
  <category>GxP</category>
  <category>Pharma</category>
  <category>Setup</category>
  <guid>https://antoinelucasfra.github.io/posts/reproducibility-modern-tools/</guid>
  <pubDate>Mon, 09 Jun 2025 22:00:00 GMT</pubDate>
  <media:content url="https://antoinelucasfra.github.io/posts/reproducibility-modern-tools/featured.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Statistical Tests Demystified: A Practical Guide for Scientists and Engineers</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/stats-theory-frequentist/</link>
  <description><![CDATA[ 





<section id="why-this-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-this-matters">Why this matters</h2>
<p>A few years ago I reviewed an internal report where an ingredient had been declared “effective” based on a p-value of 0.048 from a one-sample t-test on n=6 measurements. The analyst had run the right test, got a significant result, and written a conclusion. The problem: the study was powered to detect an effect three times larger than the one they claimed to have found, the variance was enormous, and the confidence interval ran from “meaningless effect” to “implausibly large effect”.</p>
<p>The statistical test had been applied correctly. The statistical reasoning had failed entirely.</p>
<p>This post is for the scientists, engineers, and product people who run statistical tests, interpret the results, and make decisions based on them — but who didn’t train as statisticians. The goal isn’t to make you a statistician. It’s to give you enough understanding to avoid the category of mistake above, to ask better questions, and to know when to call someone who does this professionally.</p>
<hr>
</section>
<section id="the-one-idea-everything-builds-on" class="level2">
<h2 class="anchored" data-anchor-id="the-one-idea-everything-builds-on">The one idea everything builds on</h2>
<p>The entire edifice of frequentist statistics rests on one uncomfortable idea: <strong>we can’t prove things, we can only assess how surprising our data would be if nothing was happening.</strong></p>
<p>The formal name for “nothing is happening” is the null hypothesis, H₀. Examples:</p>
<ul>
<li>H₀: this ingredient has no effect on skin hydration</li>
<li>H₀: the two manufacturing batches have the same mean viscosity</li>
<li>H₀: age and disease severity are unrelated</li>
</ul>
<p>The <strong>p-value</strong> is the probability of observing data at least as extreme as yours, <em>assuming H₀ is true</em>. That’s it. It is not:</p>
<ul>
<li>The probability that your result is due to chance</li>
<li>The probability that H₀ is true</li>
<li>A measure of the size or importance of an effect</li>
<li>A reproducibility guarantee</li>
</ul>
<p>A worked example. You’re testing whether a new moisturiser increases skin hydration vs.&nbsp;a placebo. You recruit 40 volunteers (20 per group), measure hydration at baseline and after 4 weeks, compute the difference, and run a t-test. You get p = 0.032.</p>
<p>What this means: if the ingredient truly had no effect, you’d see a difference this large or larger about 3.2% of the time by random chance alone. It’s reasonably unlikely, so you reject H₀.</p>
<p>What this doesn’t tell you: how big the effect is, whether it’s clinically meaningful, whether you’d get the same result in a different population, or whether you’ll replicate it in the next study.</p>
<hr>
</section>
<section id="type-i-and-type-ii-errors" class="level2">
<h2 class="anchored" data-anchor-id="type-i-and-type-ii-errors">Type I and Type II errors</h2>
<p>Every statistical test makes one of four kinds of decision. The truth is binary (effect exists or not), and your conclusion is binary (significant or not). This gives a 2×2 table:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>H₀ true (no effect)</th>
<th>H₀ false (effect exists)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Test significant</strong></td>
<td>False positive (Type I, α)</td>
<td>True positive (power)</td>
</tr>
<tr class="even">
<td><strong>Test not significant</strong></td>
<td>True negative</td>
<td>False negative (Type II, β)</td>
</tr>
</tbody>
</table>
<p><strong>Type I error (α):</strong> You conclude there’s an effect when there isn’t one. The false alarm. By convention, α = 0.05, meaning you accept a 5% chance of this per test.</p>
<p><strong>Type II error (β):</strong> You miss a real effect. The missed detection. Power = 1 − β. A study with 80% power has a 20% chance of missing a real effect of the specified size.</p>
<p>The fire alarm analogy: α is the rate at which the alarm goes off when there’s no fire. β is the rate at which there’s a fire and the alarm doesn’t go off. You want both low. They trade off against each other for a fixed sample size.</p>
<p>From these four cells you can derive four quantities that are far more useful than p-values in applied work:</p>
<ul>
<li><strong>Sensitivity</strong> = TP / (TP + FN) — probability the test fires when the effect is real</li>
<li><strong>Specificity</strong> = TN / (TN + FP) — probability the test stays quiet when there’s no effect</li>
<li><strong>PPV</strong> (positive predictive value) = TP / (TP + FP) — probability the effect is real given significance</li>
<li><strong>NPV</strong> (negative predictive value) = TN / (TN + FN) — probability there’s no effect given non-significance</li>
</ul>
<p>PPV is the one people most often forget to think about. In a field where most tested hypotheses are false (say, early-stage drug screening), even a specific test produces a lot of false positives. This is part of the replication crisis.</p>
<hr>
</section>
<section id="choosing-the-right-test" class="level2">
<h2 class="anchored" data-anchor-id="choosing-the-right-test">Choosing the right test</h2>
<p>The most common source of error is not the calculation — R will do that correctly. It’s choosing the wrong test for the question. Here’s the key decision table:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Situation</th>
<th>Test</th>
<th>R function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Compare 2 group means, normal, equal variance</td>
<td>Student’s t-test</td>
<td><code>t.test(x ~ g, var.equal = TRUE)</code></td>
</tr>
<tr class="even">
<td>Compare 2 group means, normal, unequal variance</td>
<td>Welch’s t-test (default)</td>
<td><code>t.test(x ~ g)</code></td>
</tr>
<tr class="odd">
<td>Compare 2 group means, non-normal or small n</td>
<td>Wilcoxon rank-sum</td>
<td><code>wilcox.test(x ~ g)</code></td>
</tr>
<tr class="even">
<td>Compare &gt;2 group means, normal</td>
<td>One-way ANOVA</td>
<td><code>aov(x ~ g)</code> then <code>TukeyHSD()</code></td>
</tr>
<tr class="odd">
<td>Compare &gt;2 group means, non-normal</td>
<td>Kruskal-Wallis</td>
<td><code>kruskal.test(x ~ g)</code></td>
</tr>
<tr class="even">
<td>Paired measurements (before/after)</td>
<td>Paired t-test</td>
<td><code>t.test(before, after, paired = TRUE)</code></td>
</tr>
<tr class="odd">
<td>Paired, non-normal</td>
<td>Wilcoxon signed-rank</td>
<td><code>wilcox.test(before, after, paired = TRUE)</code></td>
</tr>
<tr class="even">
<td>Two proportions</td>
<td>Chi-squared</td>
<td><code>prop.test(c(x1, x2), c(n1, n2))</code></td>
</tr>
<tr class="odd">
<td>Two proportions, small counts</td>
<td>Fisher’s exact</td>
<td><code>fisher.test(matrix(...))</code></td>
</tr>
<tr class="even">
<td>Correlation, normal</td>
<td>Pearson</td>
<td><code>cor.test(x, y)</code></td>
</tr>
<tr class="odd">
<td>Correlation, non-normal or ordinal</td>
<td>Spearman</td>
<td><code>cor.test(x, y, method = "spearman")</code></td>
</tr>
</tbody>
</table>
<p>Three questions to navigate this table:</p>
<ol type="1">
<li><strong>What is your outcome variable?</strong> Continuous, binary, count, or ordinal?</li>
<li><strong>How many groups are you comparing?</strong> Two or more?</li>
<li><strong>Are observations independent?</strong> Or paired/repeated?</li>
</ol>
<p>If you’re unsure whether your data is “normal enough” for a parametric test: with n ≥ 30 per group, the central limit theorem covers you for most practical purposes. Below 30, check with a quantile-quantile (QQ) plot (<code>qqnorm()</code> + <code>qqline()</code>) and use a non-parametric alternative if in doubt. The non-parametric versions lose some power but make fewer assumptions.</p>
<hr>
</section>
<section id="the-regression-family" class="level2">
<h2 class="anchored" data-anchor-id="the-regression-family">The regression family</h2>
<p>Tests of means and proportions cover simple comparisons. When you have multiple predictors, covariates to control for, or a continuous outcome you want to model, you need regression.</p>
<section id="linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression">Linear regression</h3>
<p>Models a continuous outcome as a linear function of one or more predictors. Use when: your outcome is continuous and approximately normal given the predictors. The fundamental model is <code>lm(outcome ~ predictor1 + predictor2, data = df)</code>. Interactions between two variables are added with <code>*</code>: <code>lm(outcome ~ A * B)</code> fits main effects for A and B plus the A×B interaction.</p>
<p>The assumptions to check: residuals normally distributed (QQ-plot of residuals), constant variance (residuals vs.&nbsp;fitted values plot), no multicollinearity among predictors (variance inflation factor). Missing any of these doesn’t make the coefficients wrong — it makes the standard errors and p-values wrong.</p>
</section>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h3>
<p>When your outcome is binary (success/failure, present/absent), linear regression is inappropriate — it predicts outside [0, 1] and the residuals are non-normal by construction. Logistic regression models the log-odds of the outcome. In R: <code>glm(outcome ~ predictors, family = binomial)</code>. Coefficients are on the log-odds scale; exponentiate them (<code>exp(coef(model))</code>) to get odds ratios, which are more interpretable.</p>
<p>The key assumption that’s often violated: logistic regression requires approximately 10 outcome events per predictor variable. If you have 50 cases of a disease and 8 predictors, you’re on the edge. Be conservative.</p>
</section>
<section id="mixed-models" class="level3">
<h3 class="anchored" data-anchor-id="mixed-models">Mixed models</h3>
<p>When observations are not independent — repeated measures on the same subjects, patients nested within hospitals, batches within production runs — standard regression underestimates uncertainty because it ignores the correlation structure. Mixed models (also called multilevel or hierarchical models) handle this by estimating both fixed effects (the parameters you care about) and random effects (the structure that creates correlation).</p>
<p>In R, <code>lme4::lmer()</code> for continuous outcomes and <code>lme4::glmer()</code> for binary. These models require more thought to specify correctly — but using a standard regression when you have clustered data is not a conservative choice, it’s a wrong one.</p>
<hr>
</section>
</section>
<section id="what-p-values-dont-tell-you" class="level2">
<h2 class="anchored" data-anchor-id="what-p-values-dont-tell-you">What p-values don’t tell you</h2>
<section id="effect-size" class="level3">
<h3 class="anchored" data-anchor-id="effect-size">Effect size</h3>
<p>A p-value tells you whether an effect is detectable. Effect size tells you whether it matters. With large enough n, any effect, no matter how trivially small, will be statistically significant. Standard effect size measures:</p>
<ul>
<li><strong>Cohen’s d</strong> for mean differences: d = (μ₁ − μ₂) / pooled SD. Small = 0.2, medium = 0.5, large = 0.8.</li>
<li><strong>η²</strong> (eta-squared) for ANOVA: proportion of variance explained.</li>
<li><strong>Odds ratio</strong> for logistic regression: how much more likely the outcome is per unit increase in a predictor.</li>
</ul>
<p>Always report effect sizes alongside p-values. “Statistically significant, p = 0.03” without an effect size is an incomplete result.</p>
</section>
<section id="confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="confidence-intervals">Confidence intervals</h3>
<p>A 95% confidence interval is a range of plausible values for the true parameter. It’s constructed so that, under repeated sampling, 95% of intervals computed this way would contain the true value. A wide confidence interval — even if it excludes zero — tells you the estimate is imprecise. In clinical or formulation work, precision matters as much as significance.</p>
<p>The confidence interval carries more information than the p-value. It tells you the direction, the magnitude, and the precision of the estimate simultaneously.</p>
</section>
<section id="multiple-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="multiple-comparisons">Multiple comparisons</h3>
<p>Every test you run at α = 0.05 has a 5% false positive rate. Run 20 tests and you expect one false positive just by chance. This is not a hypothetical problem — it’s routine in omics data, sensory profiling panels, and screening experiments.</p>
<p>Common corrections:</p>
<ul>
<li><strong>Bonferroni</strong>: divide α by the number of tests. Conservative but simple.</li>
<li><strong>Benjamini-Hochberg (FDR)</strong>: controls the expected proportion of false positives among significant results. Less conservative, more appropriate for discovery contexts.</li>
</ul>
<p>In R: <code>p.adjust(p_values, method = "BH")</code> for Benjamini-Hochberg. Use it whenever you’re reporting more than 5 or so tests simultaneously.</p>
<hr>
</section>
</section>
<section id="roc-curves" class="level2">
<h2 class="anchored" data-anchor-id="roc-curves">ROC curves</h2>
<p>When you have a continuous classifier (a model score, a biomarker value, a threshold parameter) and a binary outcome, the ROC (Receiver Operating Characteristic) curve shows the trade-off between sensitivity and specificity across all possible thresholds.</p>
<p>The area under the ROC curve (AUC) summarises classifier performance in a single number. AUC = 0.5 is a random classifier. AUC = 1.0 is a perfect classifier. In practice:</p>
<ul>
<li>AUC &gt; 0.9: excellent discrimination</li>
<li>AUC 0.7–0.9: acceptable</li>
<li>AUC 0.5–0.7: poor</li>
</ul>
<p>In R: <code>pROC::roc(outcome, score)</code> then <code>auc()</code>. The ROC curve is useful precisely because it’s threshold-agnostic — you can choose the operating threshold based on your acceptable trade-off between false positives and false negatives after seeing the curve, rather than committing upfront.</p>
<p>One caution: AUC is an average over all thresholds. In some applications (rare event detection, high-cost false positives), the area under the precision-recall curve is more informative.</p>
<hr>
</section>
<section id="quick-reference-glossary" class="level2">
<h2 class="anchored" data-anchor-id="quick-reference-glossary">Quick reference glossary</h2>
<p><strong>p-value</strong> — Probability of observing data this extreme or more extreme, given H₀ is true. Not the probability that H₀ is true.</p>
<p><strong>Null hypothesis (H₀)</strong> — The baseline assumption of no effect, no difference, no relationship.</p>
<p><strong>Type I error (α)</strong> — Rejecting H₀ when it’s true. False positive. Conventionally set to 0.05.</p>
<p><strong>Type II error (β)</strong> — Failing to reject H₀ when it’s false. False negative. Power = 1 − β.</p>
<p><strong>Power</strong> — Probability of detecting a true effect of a given size. Increases with sample size and effect size, decreases with variance.</p>
<p><strong>Effect size</strong> — A standardised measure of the magnitude of an effect, independent of sample size.</p>
<p><strong>Confidence interval</strong> — A range of plausible values for the true parameter. Width reflects estimation precision.</p>
<p><strong>ANOVA</strong> — Analysis of variance. Tests whether at least one group mean differs from the others. Does not tell you which groups differ — you need post-hoc tests (e.g.&nbsp;Tukey HSD) for that.</p>
<p><strong>Odds ratio</strong> — In logistic regression, the multiplicative change in the odds of the outcome per unit increase in a predictor. OR = 1 means no effect. OR &gt; 1 means increased odds. OR &lt; 1 means decreased odds.</p>
<p><strong>FDR</strong> — False discovery rate. The expected proportion of significant results that are false positives. Used when running many tests simultaneously (genomics, screening, sensory analysis).</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Statistics</category>
  <category>Tutorial</category>
  <category>R</category>
  <category>Reference</category>
  <category>Biostatistics</category>
  <guid>https://antoinelucasfra.github.io/posts/stats-theory-frequentist/</guid>
  <pubDate>Fri, 14 Mar 2025 23:00:00 GMT</pubDate>
  <media:content url="https://antoinelucasfra.github.io/posts/stats-theory-frequentist/featured.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>rv: The Modern R Package Manager for Reproducible Workflows</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/rv-modern-r-package-manager/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>I’ve been using <code>renv</code> for years to manage R dependencies, and while it gets the job done, I’ve always felt something was missing. The iterative workflow, the occasional dependency conflicts, the slow installations… it works, but it doesn’t feel <em>modern</em>.</p>
<p>Then I discovered <strong>rv</strong> — a declarative R package manager written in Rust — and it immediately clicked. If you’ve been following the Python ecosystem like I have, you’ve probably seen <a href="https://docs.astral.sh/uv/">uv</a> revolutionize Python package management. Well, <code>rv</code> brings that same philosophy to R: <strong>declarative configuration, fast execution, and true reproducibility</strong>. This is exactly what I’ve been waiting for.</p>
</section>
<section id="what-is-rv" class="level2">
<h2 class="anchored" data-anchor-id="what-is-rv">What is rv?</h2>
<p><code>rv</code> is an R package manager that takes a fundamentally different approach from traditional tools:</p>
<ul>
<li><strong>Declarative</strong> — You describe the <em>desired state</em> of your project, not the steps to get there</li>
<li><strong>Written in Rust</strong> — Compiled for speed (25x faster than alternatives in benchmarks)</li>
<li><strong>Holistic resolution</strong> — Resolves the entire dependency tree before installing anything</li>
<li><strong>Lock at install time</strong> — Captures all installation information when it happens, not retroactively</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rv (Linux/macOS)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-2" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sSL</span> https://raw.githubusercontent.com/A2-ai/rv/refs/heads/main/scripts/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="annotated-cell-1-3"></span>
<span id="annotated-cell-1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Or with Homebrew (macOS)</span></span>
<span id="annotated-cell-1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap a2-ai/homebrew-tap</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-6" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install rv</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="2" data-code-annotation="1">The curl installer is the universal method — works on both Linux and macOS, places the <code>rv</code> binary on your <code>PATH</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="2">Homebrew install on macOS — preferred if you already use Homebrew; handles updates via <code>brew upgrade rv</code>.</span>
</dd>
</dl>
</section>
<section id="the-problem-with-iterative-installation" class="level2">
<h2 class="anchored" data-anchor-id="the-problem-with-iterative-installation">The Problem with Iterative Installation</h2>
<p>If you’ve used R long enough, you’ve probably experienced this frustration. Traditional R package management (including <code>renv</code>) follows an <strong>iterative pattern</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The workflow we all know too well</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more packages ...</span></span>
<span id="cb1-5">renv<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">snapshot</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Capture state after the fact</span></span></code></pre></div></div>
<p>I’ve run into two issues with this approach more times than I can count:</p>
<ol type="1">
<li><strong>Incompatible versions</strong> — Packages installed at different times may have conflicting dependencies. How many times have you had a working project break after updating one package?</li>
<li><strong>Lost context</strong> — By the time you snapshot, information about <em>how</em> packages were installed is lost. Where did that package come from again?</li>
</ol>
</section>
<section id="rvs-declarative-approach" class="level2">
<h2 class="anchored" data-anchor-id="rvs-declarative-approach">rv’s Declarative Approach</h2>
<p>With <code>rv</code>, you declare what you want in a <code>rproject.toml</code> file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode toml code-annotation-code code-with-copy code-annotated"><code class="sourceCode toml"><span id="annotated-cell-3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="annotated-cell-3-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-analysis"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-3" class="code-annotation-target"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">r_version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.5"</span></span>
<span id="annotated-cell-3-4"></span>
<span id="annotated-cell-3-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repositories</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-6" class="code-annotation-target">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PPM"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://packagemanager.posit.co/cran/latest"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="annotated-cell-3-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="annotated-cell-3-8"></span>
<span id="annotated-cell-3-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-10" class="code-annotation-target">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="annotated-cell-3-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="1">Pin the R version — <code>rv</code> will warn if the active R version does not match.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="6" data-code-annotation="2">Posit Package Manager (PPM) serves pre-compiled binaries, making installs significantly faster than building from source.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="10" data-code-annotation="3">Declare only direct dependencies; <code>rv</code> resolves the full transitive dependency tree automatically.</span>
</dd>
</dl>
<p>Then synchronize your project:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span></code></pre></div></div>
<p>That’s it. Seriously. <code>rv</code> resolves the complete dependency tree, ensures compatibility, installs everything, and creates a lockfile — all in one atomic operation. The first time I ran this, I was genuinely surprised at how fast it was.</p>
</section>
<section id="quick-start" class="level2">
<h2 class="anchored" data-anchor-id="quick-start">Quick Start</h2>
<section id="initialize-a-new-project" class="level3">
<h3 class="anchored" data-anchor-id="initialize-a-new-project">Initialize a New Project</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> init my-project</span>
<span id="cb3-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> my-project</span></code></pre></div></div>
<p>This creates the following structure:</p>
<pre><code>my-project/
├── rv/
│   ├── library/
│   ├── scripts/
│   │   ├── activate.R
│   │   └── rvr.R
│   └── .gitignore
├── .Rprofile
├── rproject.toml
└── rv.lock</code></pre>
</section>
<section id="add-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="add-dependencies">Add Dependencies</h3>
<p>Edit <code>rproject.toml</code> or use the CLI:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> add dplyr ggplot2 tidyverse</span></code></pre></div></div>
</section>
<section id="check-what-will-happen" class="level3">
<h3 class="anchored" data-anchor-id="check-what-will-happen">Check What Will Happen</h3>
<p>Before installing, preview the changes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> plan</span></code></pre></div></div>
</section>
<section id="synchronize" class="level3">
<h3 class="anchored" data-anchor-id="synchronize">Synchronize</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span></code></pre></div></div>
</section>
</section>
<section id="key-commands" class="level2">
<h2 class="anchored" data-anchor-id="key-commands">Key Commands</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>rv init</code></td>
<td>Initialize a new project</td>
</tr>
<tr class="even">
<td><code>rv sync</code></td>
<td>Synchronize packages with config</td>
</tr>
<tr class="odd">
<td><code>rv add &lt;pkg&gt;</code></td>
<td>Add package to config and sync</td>
</tr>
<tr class="even">
<td><code>rv plan</code></td>
<td>Preview what sync would do</td>
</tr>
<tr class="odd">
<td><code>rv upgrade</code></td>
<td>Update packages (ignores lockfile)</td>
</tr>
<tr class="even">
<td><code>rv tree</code></td>
<td>Show dependency tree</td>
</tr>
<tr class="odd">
<td><code>rv migrate renv</code></td>
<td>Migrate from renv project</td>
</tr>
</tbody>
</table>
</section>
<section id="rv-vs-renv-a-comparison" class="level2">
<h2 class="anchored" data-anchor-id="rv-vs-renv-a-comparison">rv vs renv: A Comparison</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 45%">
<col style="width: 30%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>renv</th>
<th>rv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Installation</td>
<td>Iterative</td>
<td>Declarative</td>
</tr>
<tr class="even">
<td>Lock timing</td>
<td>After installation (snapshot)</td>
<td>At installation</td>
</tr>
<tr class="odd">
<td>Compatibility check</td>
<td>None (trust the process)</td>
<td>Full tree resolution</td>
</tr>
<tr class="even">
<td>Written in</td>
<td>R</td>
<td>Rust</td>
</tr>
<tr class="odd">
<td>Speed</td>
<td>Slower</td>
<td>~25x faster</td>
</tr>
<tr class="even">
<td>Config format</td>
<td>R code + JSON lockfile</td>
<td>TOML + lockfile</td>
</tr>
</tbody>
</table>
<section id="migrating-from-renv" class="level3">
<h3 class="anchored" data-anchor-id="migrating-from-renv">Migrating from renv</h3>
<p>If you have an existing <code>renv</code> project:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> migrate renv</span></code></pre></div></div>
<p>This converts your <code>renv.lock</code> to an <code>rv</code> configuration.</p>
</section>
</section>
<section id="the-uv-parallel-modern-package-management" class="level2">
<h2 class="anchored" data-anchor-id="the-uv-parallel-modern-package-management">The uv Parallel: Modern Package Management</h2>
<p>As someone who works in both R and Python, I find the parallels between <code>rv</code> and Python’s <code>uv</code> striking — and clearly intentional:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Concept</th>
<th>Python (uv)</th>
<th>R (rv)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Config file</td>
<td><code>pyproject.toml</code></td>
<td><code>rproject.toml</code></td>
</tr>
<tr class="even">
<td>Lock file</td>
<td><code>uv.lock</code></td>
<td><code>rv.lock</code></td>
</tr>
<tr class="odd">
<td>Sync command</td>
<td><code>uv sync</code></td>
<td><code>rv sync</code></td>
</tr>
<tr class="even">
<td>Add package</td>
<td><code>uv add</code></td>
<td><code>rv add</code></td>
</tr>
<tr class="odd">
<td>Written in</td>
<td>Rust</td>
<td>Rust</td>
</tr>
<tr class="even">
<td>Philosophy</td>
<td>Declarative, fast</td>
<td>Declarative, fast</td>
</tr>
</tbody>
</table>
<p>Both tools share the same vision, and honestly, it’s refreshing to see R catching up:</p>
<ul>
<li><strong>Speed through Rust</strong> — Compiled performance beats interpreted languages</li>
<li><strong>Declarative configuration</strong> — Describe the end state, not the steps</li>
<li><strong>Reproducibility first</strong> — Lockfiles capture everything needed to recreate the environment</li>
<li><strong>Modern developer experience (DX)</strong> — Clear CLI, helpful error messages, predictable behavior</li>
</ul>
</section>
<section id="a-modern-r-workflow-rig-rv" class="level2">
<h2 class="anchored" data-anchor-id="a-modern-r-workflow-rig-rv">A Modern R Workflow: rig + rv</h2>
<p>Here’s where things get really exciting for me. Combining <code>rv</code> with <a href="https://github.com/r-lib/rig">rig</a> (the R installation manager) gives you a workflow that finally feels on par with modern Python development:</p>
<section id="manage-r-versions-with-rig" class="level3">
<h3 class="anchored" data-anchor-id="manage-r-versions-with-rig">1. Manage R Versions with rig</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-11" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install rig (macOS)</span></span>
<span id="annotated-cell-11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap r-lib/rig</span>
<span id="annotated-cell-11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install rig</span>
<span id="annotated-cell-11-4"></span>
<span id="annotated-cell-11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Or Linux</span></span>
<span id="annotated-cell-11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://rig.r-lib.org/rig-linux-latest.tar.gz <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> tar xz <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-C</span> /usr/local</span>
<span id="annotated-cell-11-7"></span>
<span id="annotated-cell-11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List available R versions</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1">1</button><span id="annotated-cell-11-9" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> available</span>
<span id="annotated-cell-11-10"></span>
<span id="annotated-cell-11-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install a specific version</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2">2</button><span id="annotated-cell-11-12" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add 4.5</span>
<span id="annotated-cell-11-13"></span>
<span id="annotated-cell-11-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set default version</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3">3</button><span id="annotated-cell-11-15" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> default 4.5</span>
<span id="annotated-cell-11-16"></span>
<span id="annotated-cell-11-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List installed versions</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="4">4</button><span id="annotated-cell-11-18" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> list</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="9" data-code-annotation="1">Show all R versions available for download — useful for picking the right release before installing.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="12" data-code-annotation="2">Download and install R 4.5 — isolated from other installed versions, no system pollution.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="15" data-code-annotation="3">Make R 4.5 the active version returned by <code>R</code> and <code>Rscript</code> on the command line.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="18" data-code-annotation="4">Show all locally installed R versions and which is currently the default.</span>
</dd>
</dl>
</section>
<section id="manage-packages-with-rv" class="level3">
<h3 class="anchored" data-anchor-id="manage-packages-with-rv">2. Manage Packages with rv</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize project with current R version</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> init my-analysis</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rv automatically detects R version from rig</span></span>
<span id="cb9-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> rproject.toml</span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [project]</span></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># r_version = "4.5"</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...</span></span></code></pre></div></div>
</section>
<section id="the-complete-workflow" class="level3">
<h3 class="anchored" data-anchor-id="the-complete-workflow">3. The Complete Workflow</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-13" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Ensure you have the right R version</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-2" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add 4.5</span>
<span id="annotated-cell-13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> default 4.5</span>
<span id="annotated-cell-13-4"></span>
<span id="annotated-cell-13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Create a new project</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2">2</button><span id="annotated-cell-13-6" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> init data-analysis</span>
<span id="annotated-cell-13-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> data-analysis</span>
<span id="annotated-cell-13-8"></span>
<span id="annotated-cell-13-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Add your dependencies</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3">3</button><span id="annotated-cell-13-10" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> add tidyverse arrow DBI</span>
<span id="annotated-cell-13-11"></span>
<span id="annotated-cell-13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Start working</span></span>
<span id="annotated-cell-13-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">R</span></span>
<span id="annotated-cell-13-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &gt; library(tidyverse)  # Just works!</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2" data-code-annotation="1">Install R 4.5 if not already present — safe to re-run; <code>rig</code> skips the download if the version is already installed.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="6" data-code-annotation="2">Scaffold <code>rproject.toml</code> pre-filled with the current R version — ready to declare dependencies immediately.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="10" data-code-annotation="3">Add packages to <code>rproject.toml</code> and resolve + install them in one step — no separate <code>install.packages()</code> + <code>renv::snapshot()</code> cycle.</span>
</dd>
</dl>
</section>
<section id="project-specific-r-versions" class="level3">
<h3 class="anchored" data-anchor-id="project-specific-r-versions">Project-Specific R Versions</h3>
<p>The <code>r_version</code> field in <code>rproject.toml</code> ensures teammates use the correct R version:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb10-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"critical-analysis"</span></span>
<span id="cb10-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">r_version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.4"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pin to R 4.4.x</span></span></code></pre></div></div>
<p>With <code>rig</code>, switching is trivial:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> switch 4.4</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span></code></pre></div></div>
</section>
</section>
<section id="advanced-configuration" class="level2">
<h2 class="anchored" data-anchor-id="advanced-configuration">Advanced Configuration</h2>
<section id="specify-package-sources" class="level3">
<h3 class="anchored" data-anchor-id="specify-package-sources">Specify Package Sources</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb12-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-3">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mypackage"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">git</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/org/mypackage.git"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">tag</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"v1.0.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="cb12-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"internal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repository</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Internal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="cb12-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repositories</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PPM"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://packagemanager.posit.co/cran/latest"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="cb12-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Internal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://internal.company.com/r-packages"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span></span>
<span id="cb12-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="binary-vs-source" class="level3">
<h3 class="anchored" data-anchor-id="binary-vs-source">Binary vs Source</h3>
<p><code>rv</code> intelligently handles binary and source installations, with options to configure per-package:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb13-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb13-2">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arrow"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> },</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Force source compilation</span></span>
<span id="cb13-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="configure-compilation" class="level3">
<h3 class="anchored" data-anchor-id="configure-compilation">Configure Compilation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project.packages_env_vars.arrow]</span></span>
<span id="cb14-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ARROW_WITH_S3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ON"</span></span>
<span id="cb14-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ARROW_WITH_GCS</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ON"</span></span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project.configure_args]</span></span>
<span id="cb14-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--with-proj-share=/usr/local/share/proj"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
</section>
<section id="why-this-matters-for-reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="why-this-matters-for-reproducibility">Why This Matters for Reproducibility</h2>
<p>Having worked in pharma, I know how critical reproducibility is — it’s not just nice to have, it’s a regulatory requirement. The combination of declarative package management (<code>rv</code>) and explicit R version management (<code>rig</code>) solves the two problems I’ve spent countless hours debugging:</p>
<ol type="1">
<li><strong>“Works on my machine”</strong> → Lockfile captures exact package versions and sources</li>
<li><strong>“Which R version?”</strong> → <code>r_version</code> in config + <code>rig</code> for installation</li>
</ol>
<p>For regulated environments (pharma, finance, etc.), this is transformative:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-19" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clone a project</span></span>
<span id="annotated-cell-19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone https://github.com/org/clinical-analysis</span>
<span id="annotated-cell-19-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> clinical-analysis</span>
<span id="annotated-cell-19-4"></span>
<span id="annotated-cell-19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up exact R version</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1">1</button><span id="annotated-cell-19-6" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rig</span> add <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> r_version rproject.toml <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f2</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="annotated-cell-19-7"></span>
<span id="annotated-cell-19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Restore exact package environment</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="2">2</button><span id="annotated-cell-19-9" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span>
<span id="annotated-cell-19-10"></span>
<span id="annotated-cell-19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ Identical environment, guaranteed</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="6" data-code-annotation="1">Extract the <code>r_version</code> string from <code>rproject.toml</code> with <code>grep</code>/<code>cut</code> and pass it directly to <code>rig add</code> — one command installs the exact R version required by the project.</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="9" data-code-annotation="2">Install all packages from the lockfile at the exact recorded versions — deterministic, no network guessing.</span>
</dd>
</dl>
</section>
<section id="getting-started-today" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-today">Getting Started Today</h2>
<ol type="1">
<li><p><strong>Install rig</strong> for R version management:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap r-lib/rig <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install rig</span></code></pre></div></div></li>
<li><p><strong>Install rv</strong> for package management:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sSL</span> https://raw.githubusercontent.com/A2-ai/rv/refs/heads/main/scripts/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span></code></pre></div></div></li>
<li><p><strong>Create your first project</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> init my-project</span>
<span id="cb17-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> my-project</span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> add tidyverse</span>
<span id="cb17-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv</span> sync</span></code></pre></div></div></li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I’m genuinely excited about <code>rv</code>. It represents a paradigm shift in R package management — from iterative, reactive tooling to declarative, proactive workflows. Combined with <code>rig</code> for R version management, it finally gives us a modern development experience on par with what Python developers have enjoyed with <code>uv</code> and <code>pyenv</code>.</p>
<p>The R ecosystem is evolving, and I’m here for it. Tools like <code>rv</code>, <code>rig</code>, and <a href="https://posit-dev.github.io/air/">air</a> (the new R formatter) are bringing modern development practices to R. If you value reproducibility, speed, and developer experience like I do, give <code>rv</code> a try. I think you’ll be as impressed as I was.</p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://a2-ai.github.io/rv-docs/">rv Documentation</a></li>
<li><a href="https://github.com/a2-ai/rv">rv GitHub Repository</a></li>
<li><a href="https://github.com/r-lib/rig">rig - R Installation Manager</a></li>
<li><a href="https://docs.astral.sh/uv/">uv - Python Package Manager</a></li>
<li><a href="https://posit-dev.github.io/air/">air - R Code Formatter</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>R</category>
  <category>Package Management</category>
  <category>Reproducibility</category>
  <category>Rust</category>
  <category>Modern Workflow</category>
  <guid>https://antoinelucasfra.github.io/posts/rv-modern-r-package-manager/</guid>
  <pubDate>Sun, 19 Jan 2025 23:00:00 GMT</pubDate>
  <media:content url="https://antoinelucasfra.github.io/posts/rv-modern-r-package-manager/featured.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Staying Current in a Fast-Moving Field: Why I Built a Resources Catalog</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/why-curate-resources/</link>
  <description><![CDATA[ 





<section id="the-knowledge-debt-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-knowledge-debt-problem">The Knowledge Debt Problem</h2>
<p>If you work in data science, statistics, machine learning, or AI, you know the feeling: you look away for a month, and suddenly there’s a new paradigm, a new library that makes your favorite tool obsolete, or a paper that fundamentally changes how we think about a problem.</p>
<p>The field moves fast. Uncomfortably fast.</p>
<ul>
<li><strong>Statistics</strong>: New causal inference methods, Bayesian workflows, and effect estimation techniques emerge continuously</li>
<li><strong>Machine Learning</strong>: Architecture innovations, training techniques, and interpretability methods evolve monthly</li>
<li><strong>Generative AI</strong>: The pace since 2022 has been unprecedented — large language models (LLMs), diffusion models, multimodal systems</li>
<li><strong>Tooling</strong>: Package managers, reproducibility tools, and development workflows get better every year</li>
<li><strong>Best practices</strong>: What was considered “production-ready” five years ago may now be technical debt</li>
</ul>
<p>This creates what I call <strong>knowledge debt</strong> — the gap between what you know and what’s available. Unlike technical debt, knowledge debt compounds silently. You don’t realize you’re behind until you try to solve a problem and discover everyone else is using tools you’ve never heard of.</p>
<hr>
</section>
<section id="the-bookmark-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="the-bookmark-graveyard">The Bookmark Graveyard</h2>
<p>Like many practitioners, I used to save interesting links in browser bookmarks. The result? Thousands of unorganized, unsearchable, forgotten URLs. A digital graveyard of good intentions.</p>
<p>The problems with bookmarks:</p>
<ol type="1">
<li><strong>No context</strong> — Why did I save this? What problem does it solve?</li>
<li><strong>No categorization</strong> — Is this about Bayesian statistics or Shiny deployment?</li>
<li><strong>No language filtering</strong> — Is this R, Python, or language-agnostic?</li>
<li><strong>No discoverability</strong> — I can’t browse by topic when exploring</li>
<li><strong>Link rot</strong> — URLs die, and I never know until I need them</li>
</ol>
<p>I needed something better: a structured, searchable, categorized collection that I could actually <em>use</em>.</p>
<hr>
</section>
<section id="building-the-resources-catalog" class="level2">
<h2 class="anchored" data-anchor-id="building-the-resources-catalog">Building the Resources Catalog</h2>
<p>That’s why I created the <a href="../../projects/resources_catalog.html">Resources Catalog</a> — a curated collection of data science resources organized by type, language, and category.</p>
<section id="the-philosophy" class="level3">
<h3 class="anchored" data-anchor-id="the-philosophy">The Philosophy</h3>
<p>The catalog isn’t trying to be comprehensive. The internet already has “awesome lists” with thousands of links. Instead, it reflects my actual learning journey:</p>
<ul>
<li><strong>Books</strong> that shaped how I think about problems</li>
<li><strong>Packages</strong> that I’ve found genuinely useful in practice</li>
<li><strong>Blogs</strong> from practitioners who write thoughtfully</li>
<li><strong>Papers</strong> that introduced important concepts</li>
<li><strong>Courses</strong> that are worth the time investment</li>
<li><strong>Tools</strong> that improve my daily workflow</li>
</ul>
</section>
<section id="organization-principles" class="level3">
<h3 class="anchored" data-anchor-id="organization-principles">Organization Principles</h3>
<p>Each resource is tagged with:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Type</strong></td>
<td>Book, Blog, Package, Course, Paper, Website, Video, Community</td>
</tr>
<tr class="even">
<td><strong>Language</strong></td>
<td>R, Python, Other (for language-agnostic resources)</td>
</tr>
<tr class="odd">
<td><strong>Category</strong></td>
<td>Topic areas like Statistics, Machine Learning, Bayesian, Shiny, Visualization</td>
</tr>
</tbody>
</table>
<p>This structure means I can quickly answer questions like:</p>
<ul>
<li>“What are the best resources for learning Bayesian statistics in R?”</li>
<li>“Which blogs should I follow for Python machine learning?”</li>
<li>“What packages exist for Shiny production deployment?”</li>
</ul>
<hr>
</section>
</section>
<section id="the-domains-that-matter" class="level2">
<h2 class="anchored" data-anchor-id="the-domains-that-matter">The Domains That Matter</h2>
<p>Looking at my catalog, some patterns emerge. These are the domains where staying current has the highest return on investment:</p>
<section id="statistical-methodology" class="level3">
<h3 class="anchored" data-anchor-id="statistical-methodology">1. Statistical Methodology</h3>
<p>Statistics isn’t static. Recent years have seen significant advances in:</p>
<ul>
<li><strong>Causal inference</strong>: Moving beyond correlation to actual causal claims</li>
<li><strong>Bayesian workflows</strong>: Stan, brms, and probabilistic programming</li>
<li><strong>Mixed models</strong>: Proper handling of hierarchical/longitudinal data</li>
<li><strong>Effect estimation</strong>: Beyond p-values to effect sizes and uncertainty</li>
</ul>
<p>Resources like <a href="https://github.com/rmcelreath/stat_rethinking_2022">Statistical Rethinking</a>, the <a href="https://www.r-causal.org/">R-Causal community</a>, and blogs from <a href="http://www.stat.columbia.edu/~gelman/">Andrew Gelman</a> help me stay grounded in what statistical practice should look like.</p>
</section>
<section id="machine-learning-deep-learning" class="level3">
<h3 class="anchored" data-anchor-id="machine-learning-deep-learning">2. Machine Learning &amp; Deep Learning</h3>
<p>The ML landscape shifts constantly:</p>
<ul>
<li><strong>Transformers everywhere</strong>: From NLP to computer vision to time series</li>
<li><strong>Foundation models</strong>: Pre-trained models as starting points</li>
<li><strong>Interpretability</strong>: Understanding what models actually learn</li>
<li><strong>Machine learning operations (MLOps)</strong>: Taking models from notebooks to production</li>
</ul>
<p>Resources like <a href="https://huggingface.co/">Hugging Face</a>, <a href="https://course.fast.ai/">Fast.ai</a>, and <a href="https://wandb.ai/site">Weights &amp; Biases</a> keep me connected to modern practice.</p>
</section>
<section id="generative-ai-llms" class="level3">
<h3 class="anchored" data-anchor-id="generative-ai-llms">3. Generative AI &amp; LLMs</h3>
<p>The post-2022 explosion requires active attention:</p>
<ul>
<li><strong>Model capabilities</strong>: What can LLMs actually do reliably?</li>
<li><strong>Prompt engineering</strong>: How to get useful outputs</li>
<li><strong>Integration patterns</strong>: Using LLMs in applications</li>
<li><strong>Limitations and risks</strong>: What they can’t do and when they fail</li>
</ul>
<p>Following the <a href="https://huggingface.co/blog">Hugging Face blog</a>, research labs like <a href="https://www.deepmind.com/blog">DeepMind</a>, and practitioners on social media helps filter signal from hype.</p>
</section>
<section id="reproducibility-devops" class="level3">
<h3 class="anchored" data-anchor-id="reproducibility-devops">4. Reproducibility &amp; DevOps</h3>
<p>How we build software keeps improving:</p>
<ul>
<li><strong>Package management</strong>: uv, renv, rv</li>
<li><strong>Containerization</strong>: Docker, devcontainers</li>
<li><strong>Version control</strong>: Git workflows, continuous integration/continuous deployment (CI/CD)</li>
<li><strong>Documentation</strong>: Quarto, literate programming</li>
</ul>
<p>The <a href="https://the-turing-way.netlify.app/welcome.html">Turing Way</a>, <a href="https://ropensci.org/">rOpenSci</a>, and tool-specific documentation keep me current on best practices.</p>
</section>
<section id="visualization-communication" class="level3">
<h3 class="anchored" data-anchor-id="visualization-communication">5. Visualization &amp; Communication</h3>
<p>Data is only useful if you can communicate it:</p>
<ul>
<li><strong>ggplot2 ecosystem</strong>: Extensions, themes, customization</li>
<li><strong>Interactive visualizations</strong>: Plotly, htmlwidgets, Shiny</li>
<li><strong>Dashboard design</strong>: Layout, UX, performance</li>
<li><strong>Storytelling</strong>: How to structure data narratives</li>
</ul>
<p>Resources like <a href="https://clauswilke.com/dataviz/">Fundamentals of Data Visualization</a>, the <a href="https://r-graph-gallery.com/">R Graph Gallery</a>, and blogs from visualization practitioners help me communicate better.</p>
<hr>
</section>
</section>
<section id="a-learning-system-not-just-a-list" class="level2">
<h2 class="anchored" data-anchor-id="a-learning-system-not-just-a-list">A Learning System, Not Just a List</h2>
<p>The catalog is part of a broader learning system:</p>
<section id="capture" class="level3">
<h3 class="anchored" data-anchor-id="capture">1. Capture</h3>
<p>When I encounter something interesting — a blog post, a package, a paper — I add it to the catalog immediately. The friction is low: just add a row to a CSV file.</p>
</section>
<section id="categorize" class="level3">
<h3 class="anchored" data-anchor-id="categorize">2. Categorize</h3>
<p>Tagging forces me to think: What domain is this? What language? What problem does it solve? This metacognition helps retention.</p>
</section>
<section id="review" class="level3">
<h3 class="anchored" data-anchor-id="review">3. Review</h3>
<p>Periodically, I browse the catalog by category. This surfaces forgotten resources and helps me notice patterns (e.g., “I’ve saved a lot about Bayesian methods lately — maybe I should actually learn brms properly”).</p>
</section>
<section id="apply" class="level3">
<h3 class="anchored" data-anchor-id="apply">4. Apply</h3>
<p>The ultimate test: when facing a problem, can I find a relevant resource quickly? If yes, the system works. If not, I need to improve my categorization or add missing resources.</p>
</section>
<section id="share" class="level3">
<h3 class="anchored" data-anchor-id="share">5. Share</h3>
<p>Making the catalog public creates accountability. It also helps others who are on similar learning journeys.</p>
<hr>
</section>
</section>
<section id="the-curators-mindset" class="level2">
<h2 class="anchored" data-anchor-id="the-curators-mindset">The Curator’s Mindset</h2>
<p>Maintaining a resource collection requires a specific mindset:</p>
<section id="be-selective" class="level3">
<h3 class="anchored" data-anchor-id="be-selective">Be Selective</h3>
<p>Not everything deserves a spot. The catalog should answer: “If I had limited time to learn about X, where would I start?” Adding everything dilutes value.</p>
</section>
<section id="accept-impermanence" class="level3">
<h3 class="anchored" data-anchor-id="accept-impermanence">Accept Impermanence</h3>
<p>Links die. Tools become obsolete. The catalog needs maintenance. I periodically verify links and remove resources that are no longer relevant.</p>
</section>
<section id="embrace-serendipity" class="level3">
<h3 class="anchored" data-anchor-id="embrace-serendipity">Embrace Serendipity</h3>
<p>Some of the best discoveries come from browsing adjacent categories. The structured format enables this kind of exploration.</p>
</section>
<section id="balance-depth-and-breadth" class="level3">
<h3 class="anchored" data-anchor-id="balance-depth-and-breadth">Balance Depth and Breadth</h3>
<p>Some domains need deep coverage (statistics, R programming). Others just need a few trusted entry points (specific libraries, niche topics).</p>
<hr>
</section>
</section>
<section id="starting-your-own" class="level2">
<h2 class="anchored" data-anchor-id="starting-your-own">Starting Your Own</h2>
<p>If you want to build a similar system, start simple:</p>
<ol type="1">
<li><strong>Choose a format</strong>: Spreadsheet, notion, obsidian, or a simple CSV like mine</li>
<li><strong>Define your categories</strong>: What domains do you care about?</li>
<li><strong>Start capturing</strong>: Add resources as you encounter them</li>
<li><strong>Review regularly</strong>: Browse your collection monthly</li>
<li><strong>Share if useful</strong>: Others might benefit; you’ll be motivated to maintain it</li>
</ol>
<p>The key insight: <strong>curation is a skill</strong>. Like any skill, it improves with practice. Your first version will be imperfect. That’s fine — iterate.</p>
<hr>
</section>
<section id="the-compound-interest-of-learning" class="level2">
<h2 class="anchored" data-anchor-id="the-compound-interest-of-learning">The Compound Interest of Learning</h2>
<p>Staying current isn’t about knowing everything. It’s about:</p>
<ul>
<li><strong>Knowing where to look</strong> when you need something</li>
<li><strong>Recognizing patterns</strong> across domains</li>
<li><strong>Building on foundations</strong> rather than starting from scratch each time</li>
<li><strong>Connecting ideas</strong> from different fields</li>
</ul>
<p>A well-maintained resource collection is infrastructure for this kind of continuous learning. It’s an investment that compounds over time.</p>
<p>The pace of change in data science, ML, and AI isn’t slowing down. Having a system to navigate that change — rather than being overwhelmed by it — is increasingly valuable.</p>
<p>Browse my <a href="../../projects/resources_catalog.html">Resources Catalog</a>. Fork it, adapt it, build your own. The goal isn’t to have <em>my</em> collection — it’s to have <em>a</em> collection that serves your learning journey.</p>
<hr>
</section>
<section id="resources-for-resource-curation" class="level2">
<h2 class="anchored" data-anchor-id="resources-for-resource-curation">Resources for Resource Curation</h2>
<p>Some meta-resources on learning and knowledge management:</p>
<ul>
<li><a href="https://the-turing-way.netlify.app/">The Turing Way</a> — Community handbook for reproducible research</li>
<li><a href="https://www.bigbookofr.com/">Big Book of R</a> — An excellent curated collection of R resources</li>
<li><a href="https://github.com/sindresorhus/awesome">Awesome Lists</a> — The original curated list concept</li>
<li><a href="https://www.buildingasecondbrain.com/">Second Brain</a> — Methodology for personal knowledge management</li>
<li><a href="https://github.com/aaronwangy/Data-Science-Cheatsheet">Data Science Cheatsheet</a> — Condensed reference material</li>
</ul>
<hr>
<p><em>The <a href="../../projects/resources_catalog.html">Resources Catalog</a> is continuously updated. Contributions welcome via <a href="https://github.com/antoinelucasfra/antoinelucasfra.github.io">GitHub</a>.</em></p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Data Science</category>
  <category>Machine Learning</category>
  <category>GenAI</category>
  <category>Resources</category>
  <category>Lifelong Learning</category>
  <category>Best Practices</category>
  <guid>https://antoinelucasfra.github.io/posts/why-curate-resources/</guid>
  <pubDate>Thu, 12 Dec 2024 23:00:00 GMT</pubDate>
  <media:content url="https://antoinelucasfra.github.io/posts/why-curate-resources/featured.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Getting Started with Quarto for Data Science Reports</title>
  <dc:creator>Antoine Lucas</dc:creator>
  <link>https://antoinelucasfra.github.io/posts/quarto-getting-started/</link>
  <description><![CDATA[ 





<section id="what-is-quarto" class="level2">
<h2 class="anchored" data-anchor-id="what-is-quarto">What is Quarto?</h2>
<p>Quarto is an open-source scientific and technical publishing system that lets you create:</p>
<ul>
<li>Documents (HTML, PDF, Word)</li>
<li>Presentations</li>
<li>Websites and blogs</li>
<li>Books</li>
</ul>
<p>It supports multiple programming languages including R, Python, Julia, and Observable.</p>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>Download Quarto from <a href="https://quarto.org/docs/get-started/">quarto.org</a>.</p>
</section>
<section id="your-first-quarto-document" class="level3">
<h3 class="anchored" data-anchor-id="your-first-quarto-document">Your First Quarto Document</h3>
<p>Create a file named <code>report.qmd</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb1-2"><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">title:</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> "My First Report"</span></span>
<span id="cb1-3"><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">author:</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> "Antoine Lucas"</span></span>
<span id="cb1-4"><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">date:</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> today</span></span>
<span id="cb1-5"><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">format:</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> html</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Introduction</span></span>
<span id="cb1-9"></span>
<span id="cb1-10">This is my first Quarto document.</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Car Weight vs. Fuel Efficiency"</span>)</span>
<span id="cb1-17"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div></div>
</section>
<section id="rendering" class="level3">
<h3 class="anchored" data-anchor-id="rendering">Rendering</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto</span> render report.qmd</span></code></pre></div></div>
</section>
</section>
<section id="key-features" class="level2">
<h2 class="anchored" data-anchor-id="key-features">Key Features</h2>
<section id="code-execution-options" class="level3">
<h3 class="anchored" data-anchor-id="code-execution-options">Code Execution Options</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| echo: true      # Show the code</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| eval: true      # Run the code</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| warning: false  # Hide warnings</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-width: 8    # Figure width</span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-height: 6   # Figure height</span></span></code></pre></div></div>
</section>
<section id="cross-references" class="level3">
<h3 class="anchored" data-anchor-id="cross-references">Cross-References</h3>
<p>Reference figures, tables, and sections:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1">See @fig-scatter for the visualization.</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: fig-scatter</span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-cap: "Scatter plot of weight vs mpg"</span></span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>()</span></code></pre></div></div>
<p>```</p>
</section>
<section id="callouts" class="level3">
<h3 class="anchored" data-anchor-id="callouts">Callouts</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a note callout for additional information.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a warning callout for important caveats.</p>
</div>
</div>
</section>
</section>
<section id="benefits-for-data-science" class="level2">
<h2 class="anchored" data-anchor-id="benefits-for-data-science">Benefits for Data Science</h2>
<ol type="1">
<li><strong>Single source of truth</strong> — Code and narrative together</li>
<li><strong>Multiple output formats</strong> — One document, many formats</li>
<li><strong>Reproducibility</strong> — Anyone can re-run your analysis</li>
<li><strong>Version control friendly</strong> — Plain text format works well with Git</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Quarto is an excellent tool for creating reproducible data science reports. Start with simple documents and gradually explore its advanced features.</p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://quarto.org/docs/guide/">Quarto Documentation</a></li>
<li><a href="https://quarto.org/docs/gallery/">Quarto Gallery</a></li>
<li><a href="https://github.com/mcanouil/awesome-quarto">Awesome Quarto</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Quarto</category>
  <category>Tutorial</category>
  <category>Reproducibility</category>
  <guid>https://antoinelucasfra.github.io/posts/quarto-getting-started/</guid>
  <pubDate>Tue, 09 Jul 2024 22:00:00 GMT</pubDate>
  <media:content url="https://antoinelucasfra.github.io/posts/quarto-getting-started/featured.png" medium="image" type="image/png" height="76" width="144"/>
</item>
</channel>
</rss>
